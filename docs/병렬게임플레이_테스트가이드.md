# 병렬 게임플레이 테스트 가이드

**작성일**: 2025-10-20
**버전**: 1.0
**테스트 대상**: 병렬 게임플레이 시스템 (InvestigationScreen with Tabs)

---

## 목차
1. [테스트 환경 설정](#테스트-환경-설정)
2. [핵심 테스트 시나리오](#핵심-테스트-시나리오)
3. [상세 검증 체크리스트](#상세-검증-체크리스트)
4. [예상 동작 vs 실제 동작](#예상-동작-vs-실제-동작)
5. [버그 리포팅 가이드](#버그-리포팅-가이드)

---

## 테스트 환경 설정

### 로컬 개발 서버
```bash
# 개발 서버 시작
npm run dev

# 서버 확인
# CLIENT: http://localhost:5173 (vite dev server)
# DEVVIT: https://www.reddit.com/r/armchair_sleuths_dev/?playtest=armchair-sleuths
```

### 빌드 검증
```bash
# 프로덕션 빌드 테스트
npm run build

# 예상 결과:
# ✓ CLIENT: 446 modules, ~383KB (gzip: ~120KB)
# ✓ SERVER: 981 modules, ~5.1MB
# ✓ 빌드 에러 없음
```

### 브라우저 개발자 도구 준비
- **Console**: 에러 로그 확인
- **Network**: API 호출 검증
- **React DevTools**: 컴포넌트 상태 검사
- **LocalStorage**: 액션 포인트, 증거 저장 확인

---

## 핵심 테스트 시나리오

### 시나리오 1: 병렬 탐색 기본 플로우

**목표**: 장소 탐색과 용의자 심문을 자유롭게 전환하며 수사 진행

**단계**:
1. **케이스 로딩** → "수사 시작" 클릭
2. **Investigation 화면 진입** → 기본 탭 = "장소 탐색" (🗺️)
3. **장소 탐색**:
   - 액션 포인트 확인 (10/10 AP 표시)
   - 첫 번째 장소에서 "빠른 탐색" (1 AP 소모)
   - 증거 발견 모달 확인
   - 액션 포인트 감소 확인 (9/10 AP)
4. **탭 전환** → "용의자 심문" 탭 클릭 (👤)
5. **용의자 심문**:
   - 액션 포인트 유지 확인 (9/10 AP 그대로)
   - 첫 번째 용의자 선택
   - 프로필 이미지 로딩 확인
   - 채팅 인터페이스 표시 확인
6. **탭 재전환** → "장소 탐색" 탭 재클릭 (🗺️)
7. **상태 보존 확인**:
   - 이전에 탐색한 장소 "탐색됨" 표시
   - 발견한 증거 수 유지
   - 액션 포인트 9/10 유지

**예상 결과**:
✅ 탭 전환 시 매끄러운 애니메이션 (Framer Motion)
✅ 액션 포인트 10AP → 9AP 유지
✅ 탐색 진행도 1/N 유지
✅ 발견 증거 수 유지
✅ 채팅 히스토리 보존 (탭 재전환 시)

---

### 시나리오 2: 액션 포인트 공유 검증

**목표**: 장소 탐색과 용의자 심문에서 동일한 액션 포인트 풀 사용 확인

**단계**:
1. **초기 상태** → 10/10 AP
2. **장소 탐색 탭**:
   - 장소 A: 빠른 탐색 (1 AP) → 9/10 AP
   - 장소 B: 철저 탐색 (2 AP) → 7/10 AP
3. **용의자 심문 탭 전환**:
   - 액션 포인트 확인 → 7/10 AP 표시 (동일)
   - 용의자 A 심문 (0 AP - 심문은 무료)
4. **장소 탐색 탭 재전환**:
   - 액션 포인트 확인 → 7/10 AP 유지
   - 장소 C: 전면 탐색 (3 AP) → 4/10 AP
5. **용의자 심문 탭 재전환**:
   - 액션 포인트 확인 → 4/10 AP 표시

**예상 결과**:
✅ 모든 탭에서 동일한 AP 표시
✅ 장소 탐색에서만 AP 소모
✅ 용의자 심문은 AP 소모 없음
✅ 탭 전환 시 AP 상태 즉시 반영

**검증 방법**:
```javascript
// Browser DevTools Console
localStorage.getItem('actionPoints_[caseId]_[userId]')
// 예상: {"current":4,"max":10,"lastUpdate":1729404000000}
```

---

### 시나리오 3: 플레이어 상태 공유 검증

**목표**: 탭 간 발견한 증거와 대화 내용 보존 확인

**단계**:
1. **장소 탐색 탭**:
   - 장소 A 탐색 → 증거 2개 발견
   - "발견한 증거: 2" 표시 확인
2. **용의자 심문 탭 전환**:
   - 용의자 A 선택 → 질문 3개 전송
   - 대화 히스토리 3개 메시지 확인
3. **장소 탐색 탭 재전환**:
   - "발견한 증거: 2" 여전히 표시
   - 장소 B 탐색 → 증거 1개 추가 발견
   - "발견한 증거: 3" 업데이트 확인
4. **용의자 심문 탭 재전환**:
   - 용의자 A 재선택
   - 이전 대화 3개 메시지 보존 확인
   - 추가 질문 2개 전송 → 총 5개 메시지

**예상 결과**:
✅ 증거 발견 횟수 누적 (2 → 3)
✅ 채팅 히스토리 완전 보존 (3 → 5 메시지)
✅ 탐색한 장소 상태 유지 ("탐색됨" 표시)
✅ 용의자별 감정 상태 유지 (의심도, 어조)

**검증 방법**:
```javascript
// Browser DevTools → Application → LocalStorage
discoveredEvidence_[caseId]_[userId]  // 증거 목록
conversation_[caseId]_[suspectId]_[userId]  // 채팅 히스토리
```

---

### 시나리오 4: 완전 플로우 E2E 테스트

**목표**: 케이스 시작부터 제출까지 전체 흐름 검증

**단계**:
1. **로딩 화면** → 케이스 생성/로딩
2. **인트로 화면** (있는 경우) → 나레이션 스킵 또는 완료
3. **케이스 개요** → "수사 시작" 클릭
4. **Investigation 화면** → 장소 탐색 탭 (기본)
5. **장소 탐색 (3분)**:
   - 3개 장소 탐색 (빠른/철저/전면 혼합)
   - 총 6-8개 증거 발견
   - AP 소모: ~6-8 AP
6. **용의자 심문 (5분)**:
   - 3명 용의자 심문
   - 각 용의자 3-5개 질문
   - 의심도 변화 관찰
7. **추가 장소 탐색 (2분)**:
   - 남은 장소 1-2개 추가 탐색
   - AP 완전 소진 (0/10 AP)
8. **수사 완료** → "수사 완료" 버튼 클릭
9. **제출 화면**:
   - 5W1H 답안 작성
   - "최종 제출" 클릭
10. **결과 화면**:
    - 점수 확인
    - 정답 비교
    - 리더보드 확인

**예상 결과**:
✅ 전체 플로우 에러 없이 완료
✅ 탭 전환 20-30회 수행 시 버그 없음
✅ 데이터 손실 없음 (증거, 채팅, AP)
✅ 제출 시 모든 수집 데이터 포함
✅ 결과 화면 정상 표시

---

## 상세 검증 체크리스트

### UI/UX 검증

#### InvestigationScreen 헤더
- [ ] "🕵️ 수사 진행" 제목 표시
- [ ] "수사 완료" 버튼 우측 상단 고정 (sticky)
- [ ] 스크롤 시 헤더 상단 고정 유지
- [ ] "수사 완료" 클릭 → 제출 화면 이동

#### 탭 네비게이션
- [ ] 2개 탭 표시: "🗺️ 장소 탐색" / "👤 용의자 심문"
- [ ] 활성 탭 하이라이트 (bg-gray-950, text-detective-gold)
- [ ] 비활성 탭 (bg-gray-800, text-gray-400)
- [ ] 탭 클릭 시 즉시 전환 (지연 없음)
- [ ] 탭 전환 애니메이션 (Framer Motion fade)

#### 장소 탐색 섹션 (LocationExplorerSection)
- [ ] 액션 포인트 디스플레이 (⚡ 아이콘)
- [ ] 발견한 증거 카운트 (🔍 아이콘)
- [ ] 탐색 진행도 바 (N/M 장소)
- [ ] 장소 카드 그리드 (responsive: 1/2/3 columns)
- [ ] 장소 이미지 로딩 또는 이모지 표시
- [ ] 탐색 완료 장소 "✓ 탐색됨" 배지
- [ ] 탐색 중 로딩 스피너
- [ ] 증거 발견 모달 표시

#### 용의자 심문 섹션 (SuspectInterrogationSection)
- [ ] 용의자 패널 (SuspectPanel) 표시
- [ ] 용의자 프로필 이미지 progressive loading
- [ ] 선택된 용의자 하이라이트
- [ ] 용의자 미선택 시 안내 메시지
- [ ] 채팅 인터페이스 (ChatInterface) 표시
- [ ] 메시지 전송 시 즉시 반영
- [ ] 용의자 응답 타이핑 효과
- [ ] 감정 상태 변화 표시 (의심도, 어조)

### 기능 검증

#### 액션 포인트 시스템
- [ ] 초기 AP: 10/10
- [ ] 빠른 탐색: -1 AP
- [ ] 철저 탐색: -2 AP
- [ ] 전면 탐색: -3 AP
- [ ] AP 부족 시 탐색 불가 (alert)
- [ ] AP 0일 때도 탭 전환 가능
- [ ] AP 상태 localStorage 저장

#### 증거 발견 시스템
- [ ] 빠른 탐색: 0-1개 증거 (30% 확률)
- [ ] 철저 탐색: 1-2개 증거 (70% 확률)
- [ ] 전면 탐색: 2-3개 증거 (100% 확률)
- [ ] 증거 발견 모달 애니메이션
- [ ] 증거 타입 표시 (물리적/디지털/진술/기타)
- [ ] 증거 중요도 표시 (⭐⭐⭐)
- [ ] 완료율 계산 정확성
- [ ] 증거 목록 localStorage 저장

#### 용의자 심문 시스템
- [ ] 용의자 선택 시 채팅 활성화
- [ ] 메시지 전송 API 호출 성공
- [ ] 용의자 응답 AI 생성 확인
- [ ] 의심도 0-100 범위 유지
- [ ] 어조 변화 (cooperative/nervous/defensive/aggressive)
- [ ] 대화 횟수 제한 (예: 10회) 확인
- [ ] 채팅 히스토리 localStorage 저장

#### 상태 보존
- [ ] 탭 전환 시 AP 동기화
- [ ] 탭 전환 시 증거 목록 유지
- [ ] 탭 전환 시 채팅 히스토리 유지
- [ ] 탭 전환 시 탐색 상태 유지
- [ ] 새로고침 후 상태 복원 (localStorage)

### 성능 검증

#### 빌드 성능
- [ ] CLIENT 빌드 시간 < 10초
- [ ] SERVER 빌드 시간 < 15초
- [ ] 번들 크기 < 500KB (gzipped < 150KB)
- [ ] 청크 분할 적절 (code splitting)

#### 런타임 성능
- [ ] 탭 전환 지연 < 100ms
- [ ] 증거 발견 API < 2초
- [ ] 용의자 응답 API < 5초
- [ ] 메모리 누수 없음 (장시간 사용 시)
- [ ] React DevTools Profiler: 렌더링 < 16ms

### 에러 처리

#### 네트워크 에러
- [ ] 증거 발견 API 실패 → 재시도 알림
- [ ] 용의자 응답 API 실패 → 재시도 알림
- [ ] 케이스 로딩 실패 → 재생성 버튼

#### 데이터 검증
- [ ] 용의자 없을 때 → 재생성 안내
- [ ] 장소 없을 때 → 안내 메시지
- [ ] LocalStorage 손상 시 → 초기화 후 복원

---

## 예상 동작 vs 실제 동작

### 탭 전환 동작

**예상 동작**:
```
사용자 클릭: "용의자 심문" 탭
→ activeTab 상태 업데이트: 'suspects'
→ Framer Motion fadeOut (장소 탐색)
→ Framer Motion fadeIn (용의자 심문)
→ 100ms 이내 전환 완료
→ 용의자 패널 표시
→ AP, 증거 수 동일하게 유지
```

**검증 방법**:
```javascript
// React DevTools Components
<InvestigationScreen>
  state.activeTab: 'suspects'
  <SuspectInterrogationSection>
    props.suspects: Array(4)
    props.caseId: "case_xyz"
```

### 액션 포인트 동기화

**예상 동작**:
```
장소 탐색 탭:
  빠른 탐색 (-1 AP)
  → localStorage: {"current":9,"max":10}
  → useActionPoints hook 업데이트

용의자 심문 탭 전환:
  → useActionPoints hook 읽기
  → localStorage에서 9 AP 로드
  → ActionPointsDisplay 컴포넌트 9/10 표시
```

**검증 방법**:
```javascript
// Browser DevTools Console
JSON.parse(localStorage.getItem('actionPoints_case123_user456'))
// { "current": 9, "max": 10, "lastUpdate": 1729404000000 }
```

### 증거 발견 프로세스

**예상 동작**:
```
철저 탐색 클릭:
  1. canAfford(2) 체크 → true
  2. deductAP(2) → 10 → 8 AP
  3. searchLocation(locationId, 'thorough')
  4. API: POST /api/evidence/search
  5. Response: { evidenceFound: [ev1, ev2], completionRate: 40 }
  6. 증거 발견 모달 열기
  7. discoveredEvidence 배열 업데이트
  8. localStorage 저장
```

**API 호출 검증**:
```bash
# Browser DevTools → Network
Request URL: http://localhost:8081/api/evidence/search
Request Method: POST
Request Payload:
{
  "caseId": "case123",
  "userId": "user456",
  "locationId": "loc_789",
  "searchType": "thorough"
}

Response:
{
  "success": true,
  "evidenceFound": [...],
  "completionRate": 40,
  "message": "2개의 증거를 발견했습니다!"
}
```

---

## 버그 리포팅 가이드

### 버그 발견 시 수집 정보

1. **재현 단계**:
   ```
   1. 케이스 로딩 완료
   2. 장소 탐색 탭에서 장소 A 빠른 탐색
   3. 용의자 심문 탭 전환
   4. 용의자 B 선택
   5. 메시지 전송 시 채팅 인터페이스 freeze
   ```

2. **콘솔 에러**:
   ```
   TypeError: Cannot read properties of undefined (reading 'id')
     at ChatInterface.tsx:42
     at updateFunctionComponent
   ```

3. **네트워크 로그**:
   ```
   POST /api/chat/send → 500 Internal Server Error
   Response: { "error": "Suspect not found" }
   ```

4. **환경 정보**:
   - OS: Windows 11
   - Browser: Chrome 120.0.6099.109
   - React DevTools: 5.0.0
   - Build: Development (npm run dev)

5. **localStorage 상태**:
   ```javascript
   {
     "actionPoints_case123_user456": {"current":9,"max":10},
     "discoveredEvidence_case123_user456": [...],
     "conversation_case123_suspect1_user456": [...]
   }
   ```

### 버그 우선순위

**P0 (Critical - 즉시 수정)**:
- [ ] 탭 전환 시 앱 크래시
- [ ] 데이터 손실 (증거, 채팅 삭제)
- [ ] 제출 불가 (수사 완료 버튼 무반응)

**P1 (High - 24시간 내 수정)**:
- [ ] AP 동기화 실패 (탭 간 불일치)
- [ ] 증거 발견 모달 표시 안됨
- [ ] 용의자 응답 무한 로딩

**P2 (Medium - 3일 내 수정)**:
- [ ] 탭 전환 애니메이션 끊김
- [ ] 프로필 이미지 로딩 느림
- [ ] 의심도 업데이트 지연

**P3 (Low - 다음 릴리스)**:
- [ ] UI 정렬 미세 조정
- [ ] 색상 대비 개선
- [ ] 도움말 텍스트 수정

---

## 테스트 결과 기록 템플릿

### 테스트 세션 헤더
```
테스트 일시: 2025-10-20 14:30 KST
테스터: [이름]
빌드 버전: 0.0.36.90
환경: Windows 11 / Chrome 120
```

### 시나리오별 결과
```
[ ✅ / ❌ ] 시나리오 1: 병렬 탐색 기본 플로우
  ✅ 탭 전환 정상
  ✅ AP 공유 정상
  ❌ 증거 모달 애니메이션 끊김 (P2)

[ ✅ / ❌ ] 시나리오 2: 액션 포인트 공유 검증
  ✅ AP 동기화 정상
  ✅ AP 소모 정확
  ✅ localStorage 저장 정상

[ ✅ / ❌ ] 시나리오 3: 플레이어 상태 공유 검증
  ✅ 증거 목록 유지
  ❌ 채팅 히스토리 일부 누락 (P1 버그)

[ ✅ / ❌ ] 시나리오 4: 완전 플로우 E2E
  ✅ 전체 플로우 완료
  ✅ 제출 성공
  ✅ 결과 표시 정상
```

### 발견된 버그
```
Bug #1 [P1]: 채팅 히스토리 누락
  재현율: 3/5
  재현 단계: [위 섹션 참고]
  콘솔 에러: [로그 첨부]

Bug #2 [P2]: 증거 모달 애니메이션 끊김
  재현율: 5/5
  재현 단계: [위 섹션 참고]
  스크린샷: [첨부]
```

---

## 자동화된 테스트 (향후 구현)

### Unit Tests
```typescript
// LocationExplorerSection.test.tsx
describe('LocationExplorerSection', () => {
  it('should deduct AP on quick search', () => {
    // ...
  });

  it('should preserve state on unmount', () => {
    // ...
  });
});
```

### Integration Tests
```typescript
// InvestigationScreen.test.tsx
describe('Tab Switching', () => {
  it('should sync AP between tabs', () => {
    // ...
  });
});
```

### E2E Tests (Playwright)
```typescript
// parallel-gameplay.spec.ts
test('complete investigation flow', async ({ page }) => {
  await page.goto('/');
  await page.click('text=수사 시작');
  await page.click('text=장소 탐색');
  // ...
});
```

---

## 결론

이 테스트 가이드를 통해 병렬 게임플레이 시스템의 모든 핵심 기능을 검증할 수 있습니다.

**테스트 성공 기준**:
- ✅ 모든 P0/P1 버그 해결
- ✅ 4개 핵심 시나리오 100% 통과
- ✅ 탭 전환 30회 이상 무오류
- ✅ E2E 플로우 3회 연속 성공

**다음 단계**:
1. 수동 테스트 수행 (이 가이드 따라)
2. 버그 수정
3. 자동화 테스트 작성
4. 프로덕션 배포

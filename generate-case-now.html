<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼€ì´ìŠ¤ ìë™ ìƒì„±ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .big-button {
            width: 100%;
            padding: 30px;
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            margin-bottom: 20px;
        }

        .big-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.6);
        }

        .big-button:active {
            transform: translateY(-2px);
        }

        .big-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        #output {
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            display: none;
        }

        #output.show {
            display: block;
        }

        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0ff; }
        .warning { color: #ff0; }

        .step {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .final-instruction {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .final-instruction.show {
            display: block;
        }

        .final-instruction h2 {
            color: #856404;
            margin-bottom: 15px;
        }

        .final-instruction p {
            color: #856404;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ•µï¸ ì¼€ì´ìŠ¤ ìë™ ìƒì„±ê¸°</h1>

        <button id="generateBtn" class="big-button" onclick="generateCase()">
            ğŸ² ìƒˆ ì¼€ì´ìŠ¤ ìƒì„±í•˜ê¸°
        </button>

        <div id="output"></div>

        <div id="finalInstruction" class="final-instruction">
            <h2>âœ… ìƒì„± ì™„ë£Œ!</h2>
            <p><strong>ì´ì œ ë‹¤ìŒ URLë¡œ ì´ë™í•˜ì„¸ìš”:</strong></p>
            <p><a href="https://www.reddit.com/r/armchair_sleuths_dev/?playtest=armchair-sleuths"
                  target="_blank"
                  style="color: #667eea; text-decoration: none; font-weight: bold;">
                ğŸ”— https://www.reddit.com/r/armchair_sleuths_dev/?playtest=armchair-sleuths
            </a></p>
            <p>í˜ì´ì§€ë¥¼ <strong>ìƒˆë¡œê³ ì¹¨(F5)</strong>í•˜ë©´ ìƒˆ ì¼€ì´ìŠ¤ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            output.classList.add('show');

            const className = type === 'error' ? 'error' :
                            type === 'success' ? 'success' :
                            type === 'warning' ? 'warning' : 'info';

            output.innerHTML += `<span class="${className}">${new Date().toLocaleTimeString()} - ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        async function generateCase() {
            const btn = document.getElementById('generateBtn');
            const output = document.getElementById('output');
            const finalInstruction = document.getElementById('finalInstruction');

            // ì´ˆê¸°í™”
            output.innerHTML = '';
            output.classList.add('show');
            finalInstruction.classList.remove('show');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> ìƒì„± ì¤‘... (30-60ì´ˆ)';

            try {
                log('ğŸ¬ ìë™ ì¼€ì´ìŠ¤ ìƒì„± ì‹œì‘...\n', 'info');

                // 1ë‹¨ê³„: í˜„ì¬ ì¼€ì´ìŠ¤ í™•ì¸
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
                log('ğŸ“‹ 1ë‹¨ê³„: í˜„ì¬ ì¼€ì´ìŠ¤ í™•ì¸ ì¤‘...', 'info');

                try {
                    const currentResponse = await fetch('/api/case/today');
                    const currentCase = await currentResponse.json();

                    if (currentResponse.ok) {
                        log(`âœ… í˜„ì¬ ì¼€ì´ìŠ¤: ${currentCase.id}`, 'success');
                        log(`   - ìš©ì˜ì: ${currentCase.suspects?.length || 0}ëª…`, 'info');
                        log(`   - ìƒì„±: ${new Date(currentCase.generatedAt).toLocaleString()}\n`, 'info');
                    } else {
                        log(`âš ï¸  í˜„ì¬ ì¼€ì´ìŠ¤ ì—†ìŒ\n`, 'warning');
                    }
                } catch (e) {
                    log(`âš ï¸  í˜„ì¬ ì¼€ì´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰)\n`, 'warning');
                }

                // 2ë‹¨ê³„: ìƒˆ ì¼€ì´ìŠ¤ ìƒì„±
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
                log('ğŸ”„ 2ë‹¨ê³„: ìƒˆ ì¼€ì´ìŠ¤ ìƒì„± ì¤‘...', 'info');
                log('   â° AIê°€ ì‚¬ê±´, ìš©ì˜ì, ì¦ê±°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                log('   â° 30-60ì´ˆê°€ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤\n', 'info');

                const generateResponse = await fetch('/api/case/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const generateResult = await generateResponse.json();

                if (generateResponse.ok) {
                    log(`âœ…âœ…âœ… ìƒˆ ì¼€ì´ìŠ¤ ìƒì„± ì„±ê³µ!`, 'success');
                    log(`   - ì¼€ì´ìŠ¤ ID: ${generateResult.caseId}`, 'success');
                    log(`   - ë‚ ì§œ: ${generateResult.date}`, 'success');
                    log(`   - ${generateResult.message}\n`, 'success');
                } else {
                    throw new Error(generateResult.message || generateResult.error || 'ì¼€ì´ìŠ¤ ìƒì„± ì‹¤íŒ¨');
                }

                // 3ë‹¨ê³„: ëŒ€ê¸°
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
                log('â° 3ë‹¨ê³„: ë°ì´í„° ì €ì¥ ì™„ë£Œ ëŒ€ê¸° ì¤‘... (3ì´ˆ)', 'info');
                await new Promise(resolve => setTimeout(resolve, 3000));
                log('âœ… ëŒ€ê¸° ì™„ë£Œ\n', 'success');

                // 4ë‹¨ê³„: í™•ì¸
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
                log('ğŸ“‹ 4ë‹¨ê³„: ìƒì„±ëœ ì¼€ì´ìŠ¤ í™•ì¸ ì¤‘...', 'info');

                const updatedResponse = await fetch('/api/case/today');
                const updatedCase = await updatedResponse.json();

                if (updatedResponse.ok) {
                    log(`âœ… ì¼€ì´ìŠ¤ ID: ${updatedCase.id}`, 'success');
                    log(`   - ë‚ ì§œ: ${updatedCase.date}`, 'info');
                    log(`   - í”¼í•´ì: ${updatedCase.victim?.name || 'N/A'}`, 'info');
                    log(`   - ë¬´ê¸°: ${updatedCase.weapon?.name || 'N/A'}`, 'info');
                    log(`   - ì¥ì†Œ: ${updatedCase.location?.name || 'N/A'}`, 'info');
                    log(`   - ìš©ì˜ì: ${updatedCase.suspects?.length || 0}ëª…\n`, updatedCase.suspects?.length > 0 ? 'success' : 'error');

                    if (updatedCase.suspects && updatedCase.suspects.length > 0) {
                        log('ğŸ‘¥ ìš©ì˜ì ëª©ë¡:', 'success');
                        updatedCase.suspects.forEach((s, i) => {
                            log(`   ${i + 1}. ${s.name} (${s.archetype})`, 'success');
                        });
                        log('', 'info');

                        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
                        log('ğŸ‰ğŸ‰ğŸ‰ ì„±ê³µ! ğŸ‰ğŸ‰ğŸ‰', 'success');
                        log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
                        log('', 'info');
                        log('âœ… ì¼€ì´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                        log('âœ… ìš©ì˜ì ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                        log('âœ… ìˆ˜ì •ì‚¬í•­ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!', 'success');
                        log('', 'info');

                        // ìµœì¢… ì•ˆë‚´ í‘œì‹œ
                        finalInstruction.classList.add('show');

                    } else {
                        log('', 'error');
                        log('âŒâŒâŒ ê²½ê³ : ìš©ì˜ìê°€ ì—¬ì „íˆ 0ëª…ì…ë‹ˆë‹¤!', 'error');
                        log('', 'error');
                        log('ë¬¸ì œê°€ ì§€ì†ë©ë‹ˆë‹¤. ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                    }
                } else {
                    throw new Error('ì¼€ì´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨');
                }

            } catch (error) {
                log('', 'error');
                log('âŒ ì˜¤ë¥˜ ë°œìƒ:', 'error');
                log(`   ${error.message}`, 'error');
                log('', 'error');
                log('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ² ìƒˆ ì¼€ì´ìŠ¤ ë‹¤ì‹œ ìƒì„±í•˜ê¸°';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´
        window.addEventListener('load', () => {
            log('ì¤€ë¹„ ì™„ë£Œ! "ìƒˆ ì¼€ì´ìŠ¤ ìƒì„±í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html>

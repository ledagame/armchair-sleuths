# ì¥ì†Œ íƒìƒ‰ ë° ì¦ê±° ìˆ˜ì§‘ ì‹œìŠ¤í…œ ì„¤ê³„

## ê°œìš”

ì´ ë¬¸ì„œëŠ” ì¥ì†Œ íƒìƒ‰ê³¼ ì¦ê±° ìˆ˜ì§‘ ì‹œìŠ¤í…œì˜ ìƒì„¸ ì„¤ê³„ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. í˜„ì¬ ê²Œì„ ìƒì„± í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ 4ê°œì˜ íƒìƒ‰ ê°€ëŠ¥í•œ ì¥ì†Œì™€ 10-15ê°œì˜ ì¦ê±°ë¥¼ ìƒì„±í•˜ê³ , ëª¨ë“  ìš”ì†Œì— ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

**ì„¤ê³„ ì›ì¹™**:
1. **Fair Play**: ëª¨ë“  ì¦ê±°ê°€ í”Œë ˆì´ì–´ì—ê²Œ ì ‘ê·¼ ê°€ëŠ¥
2. **Three Clue Rule**: ê° ìš©ì˜ìë‹¹ ìµœì†Œ 3ê°œì˜ ë…ë¦½ì  ë‹¨ì„œ
3. **Gumshoe ì›ì¹™**: ì°¾ê¸°ëŠ” ì‰½ê²Œ, í•´ì„ì€ ì–´ë µê²Œ
4. **ë¹„ì„ í˜• ì¡°ì‚¬**: í”Œë ˆì´ì–´ê°€ ìˆœì„œ ì„ íƒ ê°€ëŠ¥
5. **80-90ì  í’ˆì§ˆ**: Over-engineering ì—†ì´ íƒ„íƒ„í•œ ê¸°ë³¸ê¸°

---

## ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê²Œì„ ìƒì„± ì‹œìŠ¤í…œ (í™•ì¥)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ ìš”ì†Œ ì„ íƒ â”‚        â”‚ ìŠ¤í† ë¦¬   â”‚        â”‚ ì´ë¯¸ì§€   â”‚
   â”‚(ê²°ì •ë¡ ì )â”‚        â”‚ ìƒì„±     â”‚        â”‚ ìƒì„±     â”‚
   â”‚         â”‚        â”‚(ë¹„ê²°ì •ë¡ ì )â”‚       â”‚(ë¹„ë™ê¸°)  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚           í™•ì¥ëœ ë°ì´í„° êµ¬ì¡°                    â”‚
   â”‚                                                â”‚
   â”‚  - ê¸°ì¡´: ë¬´ê¸°, ë™ê¸°, ì¥ì†Œ(1ê°œ), ìš©ì˜ì(3ëª…)     â”‚
   â”‚  - ì¶”ê°€: íƒìƒ‰ ì¥ì†Œ(4ê°œ), ì¦ê±°(10-15ê°œ)         â”‚
   â”‚  - ì´ë¯¸ì§€: ìš©ì˜ì, ì¥ì†Œ, ì¦ê±° ëª¨ë‘ í¬í•¨         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë°ì´í„° ëª¨ë¸ ì„¤ê³„

### 1. Location (ì¥ì†Œ)

```typescript
interface Location {
  id: string;                    // ê³ ìœ  ID (ì˜ˆ: "loc-study", "loc-garden")
  name: string;                  // ì¥ì†Œ ì´ë¦„ (ì˜ˆ: "ë°€ì‹¤ ì„œì¬")
  description: string;           // ìƒì„¸ ì„¤ëª…
  imageUrl: string;              // ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼ ì´ë¯¸ì§€ URL
  evidenceIds: string[];         // ì´ ì¥ì†Œì—ì„œ ë°œê²¬ ê°€ëŠ¥í•œ ì¦ê±° ID ëª©ë¡
  isMainLocation: boolean;       // ëŒ€í‘œ ì¥ì†Œ ì—¬ë¶€ (1ê°œë§Œ true)
  accessibleFrom?: string[];     // ì ‘ê·¼ ê°€ëŠ¥í•œ ë‹¤ë¥¸ ì¥ì†Œ (ì„ íƒì )
}
```

**ìƒì„± ê·œì¹™**:
- ì´ 5ê°œ ì¥ì†Œ ìƒì„± (ëŒ€í‘œ 1ê°œ + íƒìƒ‰ ê°€ëŠ¥ 4ê°œ)
- ê° ì¥ì†ŒëŠ” 2-4ê°œì˜ ì¦ê±° í¬í•¨
- ì¥ì†Œ ê°„ ë…¼ë¦¬ì  ì—°ê²° (ì˜ˆ: ì„œì¬ â†’ ë³µë„ â†’ ì •ì›)

### 2. Evidence (ì¦ê±°)

```typescript
interface Evidence {
  id: string;                    // ê³ ìœ  ID (ì˜ˆ: "ev-poison-bottle")
  name: string;                  // ì¦ê±° ì´ë¦„ (ì˜ˆ: "ë…ê·¹ë¬¼ ë³‘")
  description: string;           // ìƒì„¸ ì„¤ëª…
  imageUrl: string;              // ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼ ì´ë¯¸ì§€ URL
  locationId: string;            // ë°œê²¬ ì¥ì†Œ ID
  relatedSuspects: string[];     // ì—°ê´€ëœ ìš©ì˜ì ID ëª©ë¡
  suspicionLevel: 'high' | 'medium' | 'low';  // ì˜ì‹¬ ìˆ˜ì¤€
  isRedHerring: boolean;         // í—ˆìœ„ ë‹¨ì„œ ì—¬ë¶€
  clueType: 'physical' | 'document' | 'testimony' | 'digital';
  discoveredAt?: number;         // ë°œê²¬ ì‹œê° (íƒ€ì„ìŠ¤íƒ¬í”„)
}
```

**ìƒì„± ê·œì¹™**:
- ì´ 10-15ê°œ ì¦ê±° ìƒì„±
- Three Clue Rule ì¤€ìˆ˜:
  - ì§„ë²”ì—ê²Œ ë¶ˆë¦¬í•œ ì¦ê±°: 3-5ê°œ (high suspicion)
  - ë‹¤ë¥¸ ìš©ì˜ìì—ê²Œ ë¶ˆë¦¬í•œ ì¦ê±°: ê° 2-3ê°œ (medium/low)
- Red Herring: 2-3ê°œ (ì˜ë¯¸ ìˆëŠ” í—ˆìœ„ ë‹¨ì„œ)
- ì¦ê±° íƒ€ì… ë¶„ë°°:
  - Physical: 40% (ë¬¼ë¦¬ì  ì¦ê±°)
  - Document: 30% (ë¬¸ì„œ)
  - Testimony: 20% (ì¦ì–¸)
  - Digital: 10% (ë””ì§€í„¸)

### 3. Suspect (ìš©ì˜ì - í™•ì¥)

```typescript
interface Suspect {
  // ê¸°ì¡´ í•„ë“œ
  id: string;
  name: string;
  background: string;
  personality: string;
  isGuilty: boolean;
  
  // ì¶”ê°€ í•„ë“œ
  profileImageUrl: string;       // í”„ë¡œí•„ ì‚¬ì§„ URL
  relatedEvidenceIds: string[];  // ê´€ë ¨ ì¦ê±° ID ëª©ë¡
}
```


---

## ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### ë°±ì—”ë“œ ì»´í¬ë„ŒíŠ¸

#### 1. LocationGenerator (ì¥ì†Œ ìƒì„±ê¸°)

**ì±…ì„**: ìŠ¤í† ë¦¬ì— ë§ëŠ” íƒìƒ‰ ê°€ëŠ¥í•œ ì¥ì†Œ ìƒì„±

```typescript
class LocationGenerator {
  /**
   * ì¥ì†Œ ìƒì„±
   * @param context - ê²Œì„ ì»¨í…ìŠ¤íŠ¸ (ë¬´ê¸°, ë™ê¸°, ëŒ€í‘œ ì¥ì†Œ)
   * @param seed - ë‚ ì§œ ì‹œë“œ
   * @returns 5ê°œ ì¥ì†Œ (ëŒ€í‘œ 1ê°œ + íƒìƒ‰ ê°€ëŠ¥ 4ê°œ)
   */
  async generateLocations(
    context: GameContext,
    seed: number
  ): Promise<Location[]> {
    // 1. ëŒ€í‘œ ì¥ì†Œ (ê¸°ì¡´ ì‹œìŠ¤í…œì—ì„œ ì„ íƒëœ ê²ƒ)
    const mainLocation = this.createMainLocation(context.location);
    
    // 2. íƒìƒ‰ ê°€ëŠ¥í•œ ì¥ì†Œ 4ê°œ ìƒì„± (AI ì‚¬ìš©)
    const explorableLocations = await this.generateExplorableLocations(
      context,
      seed
    );
    
    return [mainLocation, ...explorableLocations];
  }
  
  private async generateExplorableLocations(
    context: GameContext,
    seed: number
  ): Promise<Location[]> {
    const prompt = `
ë‹¹ì‹ ì€ íƒì • ì†Œì„¤ ì‘ê°€ì…ë‹ˆë‹¤.

ë°°ê²½ ì„¤ì •:
- ëŒ€í‘œ ì¥ì†Œ: ${context.location}
- ë¬´ê¸°: ${context.weapon}
- ì‹œëŒ€/ë¶„ìœ„ê¸°: ${context.era}

ë‹¤ìŒ 4ê°œì˜ íƒìƒ‰ ê°€ëŠ¥í•œ ì¥ì†Œë¥¼ ìƒì„±í•˜ì„¸ìš”:
1. ê° ì¥ì†ŒëŠ” ëŒ€í‘œ ì¥ì†Œì™€ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°
2. ê° ì¥ì†ŒëŠ” ê³ ìœ í•œ íŠ¹ì§•ê³¼ ë¶„ìœ„ê¸°
3. ì¦ê±°ê°€ ìˆ¨ê²¨ì§ˆ ë§Œí•œ ë””í…Œì¼ í¬í•¨

ì‘ë‹µ í˜•ì‹: JSON
[
  {
    "id": "loc-hallway",
    "name": "ë³µë„",
    "description": "ì–´ë‘ìš´ ë³µë„...",
    "connectedTo": ["loc-study", "loc-garden"]
  },
  ...
]
    `;
    
    const response = await this.geminiClient.generateContent(prompt);
    return this.parseLocations(response);
  }
}
```

#### 2. EvidenceGenerator (ì¦ê±° ìƒì„±ê¸°)

**ì±…ì„**: Three Clue Ruleì„ ì¤€ìˆ˜í•˜ëŠ” ì¦ê±° ìƒì„±

```typescript
class EvidenceGenerator {
  /**
   * ì¦ê±° ìƒì„±
   * @param suspects - ìš©ì˜ì ëª©ë¡
   * @param locations - ì¥ì†Œ ëª©ë¡
   * @param solution - í•´ê²°ì±… (ì§„ë²” ì •ë³´)
   * @returns 10-15ê°œ ì¦ê±°
   */
  async generateEvidence(
    suspects: Suspect[],
    locations: Location[],
    solution: Solution
  ): Promise<Evidence[]> {
    // 1. ì§„ë²”ì—ê²Œ ë¶ˆë¦¬í•œ ì¦ê±° 3-5ê°œ
    const guiltyEvidence = await this.generateGuiltyEvidence(
      solution,
      locations,
      3 // ìµœì†Œ 3ê°œ
    );
    
    // 2. ë‹¤ë¥¸ ìš©ì˜ìì—ê²Œ ë¶ˆë¦¬í•œ ì¦ê±° (ë¯¸ìŠ¤ë””ë ‰ì…˜)
    const innocentEvidence = await this.generateInnocentEvidence(
      suspects.filter(s => !s.isGuilty),
      locations,
      2 // ê° ìš©ì˜ìë‹¹ 2ê°œ
    );
    
    // 3. Red Herring 2-3ê°œ
    const redHerrings = await this.generateRedHerrings(
      locations,
      2
    );
    
    // 4. ì¦ê±°ë¥¼ ì¥ì†Œì— ë¶„ë°°
    const allEvidence = [
      ...guiltyEvidence,
      ...innocentEvidence,
      ...redHerrings
    ];
    
    return this.distributeEvidenceToLocations(allEvidence, locations);
  }
  
  private async generateGuiltyEvidence(
    solution: Solution,
    locations: Location[],
    minCount: number
  ): Promise<Evidence[]> {
    const prompt = `
ì§„ë²”: ${solution.who}
ë²”í–‰ ë°©ë²•: ${solution.how}
ë™ê¸°: ${solution.why}

ì§„ë²”ì—ê²Œ ë¶ˆë¦¬í•œ ì¦ê±° ${minCount}ê°œë¥¼ ìƒì„±í•˜ì„¸ìš”:
- ê° ì¦ê±°ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì§„ë²”ì„ ê°€ë¦¬í‚´
- ë‹¤ì–‘í•œ íƒ€ì… (physical, document, testimony)
- ë°œê²¬ ê°€ëŠ¥í•˜ì§€ë§Œ ë¯¸ë¬˜í•¨

ì‘ë‹µ í˜•ì‹: JSON
    `;
    
    const response = await this.geminiClient.generateContent(prompt);
    return this.parseEvidence(response, 'high');
  }
}
```

#### 3. ImageGenerator (ì´ë¯¸ì§€ ìƒì„±ê¸°)

**ì±…ì„**: ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼ ì´ë¯¸ì§€ ìƒì„±

```typescript
class ImageGenerator {
  private readonly GHIBLI_STYLE_PREFIX = `
Studio Ghibli anime style, soft watercolor aesthetic,
warm lighting, hand-drawn animation quality,
whimsical yet mysterious atmosphere,
suitable for murder mystery game,
  `.trim();
  
  /**
   * ìš©ì˜ì í”„ë¡œí•„ ì´ë¯¸ì§€ ìƒì„±
   */
  async generateSuspectImage(suspect: Suspect): Promise<string> {
    const prompt = `
${this.GHIBLI_STYLE_PREFIX}
portrait of ${suspect.name}:
- ${suspect.personality}
- ${suspect.background}
- facial expression showing character
- close-up portrait style
    `;
    
    return await this.geminiClient.generateImage(prompt);
  }
  
  /**
   * ì¥ì†Œ ì´ë¯¸ì§€ ìƒì„±
   */
  async generateLocationImage(location: Location): Promise<string> {
    const prompt = `
${this.GHIBLI_STYLE_PREFIX}
${location.name}:
- ${location.description}
- explorable space with details
- places where evidence could be hidden
- atmospheric lighting
    `;
    
    return await this.geminiClient.generateImage(prompt);
  }
  
  /**
   * ì¦ê±° ì´ë¯¸ì§€ ìƒì„±
   */
  async generateEvidenceImage(evidence: Evidence): Promise<string> {
    const prompt = `
${this.GHIBLI_STYLE_PREFIX}
close-up of ${evidence.name}:
- ${evidence.description}
- clear details and features
- ${evidence.clueType} evidence type
- emphasize important characteristics
    `;
    
    return await this.geminiClient.generateImage(prompt);
  }
  
  /**
   * ëª¨ë“  ì´ë¯¸ì§€ ìƒì„± (ë³‘ë ¬ ì²˜ë¦¬)
   */
  async generateAllImages(
    suspects: Suspect[],
    locations: Location[],
    evidence: Evidence[]
  ): Promise<void> {
    const tasks = [
      ...suspects.map(s => this.generateSuspectImage(s)),
      ...locations.map(l => this.generateLocationImage(l)),
      ...evidence.map(e => this.generateEvidenceImage(e))
    ];
    
    const results = await Promise.allSettled(tasks);
    
    // ê²°ê³¼ ë§¤í•‘ ë° ì—ëŸ¬ ì²˜ë¦¬
    this.mapImagesToEntities(results, suspects, locations, evidence);
  }
}
```


### í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸

#### 1. LocationExplorer (ì¥ì†Œ íƒìƒ‰ ì»´í¬ë„ŒíŠ¸)

**ì±…ì„**: ì¥ì†Œ ëª©ë¡ ë° ìƒì„¸ í™”ë©´ í‘œì‹œ

```typescript
// src/client/components/LocationExplorer.tsx
interface LocationExplorerProps {
  locations: Location[];
  onEvidenceCollect: (evidenceId: string) => void;
  collectedEvidenceIds: string[];
}

function LocationExplorer({
  locations,
  onEvidenceCollect,
  collectedEvidenceIds
}: LocationExplorerProps) {
  const [selectedLocation, setSelectedLocation] = useState<Location | null>(null);
  
  return (
    <div className="location-explorer">
      {!selectedLocation ? (
        // ì¥ì†Œ ëª©ë¡ í™”ë©´
        <LocationGrid
          locations={locations}
          onSelect={setSelectedLocation}
        />
      ) : (
        // ì¥ì†Œ ìƒì„¸ í™”ë©´
        <LocationDetail
          location={selectedLocation}
          onBack={() => setSelectedLocation(null)}
          onEvidenceCollect={onEvidenceCollect}
          collectedEvidenceIds={collectedEvidenceIds}
        />
      )}
    </div>
  );
}
```

**í•˜ìœ„ ì»´í¬ë„ŒíŠ¸**:

```typescript
// LocationGrid - ì¥ì†Œ ì¹´ë“œ ê·¸ë¦¬ë“œ
function LocationGrid({ locations, onSelect }) {
  return (
    <div className="grid grid-cols-2 gap-4">
      {locations.map(location => (
        <LocationCard
          key={location.id}
          location={location}
          onClick={() => onSelect(location)}
        />
      ))}
    </div>
  );
}

// LocationCard - ê°œë³„ ì¥ì†Œ ì¹´ë“œ
function LocationCard({ location, onClick }) {
  const undiscoveredCount = location.evidenceIds.filter(
    id => !collectedEvidenceIds.includes(id)
  ).length;
  
  return (
    <div className="location-card" onClick={onClick}>
      <img src={location.imageUrl} alt={location.name} />
      <h3>{location.name}</h3>
      <p>{location.description.substring(0, 100)}...</p>
      <div className="evidence-count">
        ğŸ” {undiscoveredCount} / {location.evidenceIds.length}
      </div>
    </div>
  );
}

// LocationDetail - ì¥ì†Œ ìƒì„¸ í™”ë©´
function LocationDetail({
  location,
  onBack,
  onEvidenceCollect,
  collectedEvidenceIds
}) {
  return (
    <div className="location-detail">
      <button onClick={onBack}>â† ë’¤ë¡œ</button>
      <img src={location.imageUrl} alt={location.name} className="large" />
      <h2>{location.name}</h2>
      <p>{location.description}</p>
      
      <h3>ë°œê²¬ ê°€ëŠ¥í•œ ì¦ê±°</h3>
      <EvidenceList
        evidenceIds={location.evidenceIds}
        onCollect={onEvidenceCollect}
        collectedIds={collectedEvidenceIds}
      />
    </div>
  );
}
```

#### 2. EvidenceNotebook (ì¦ê±° ë…¸íŠ¸ë¶ ì»´í¬ë„ŒíŠ¸)

**ì±…ì„**: ìˆ˜ì§‘í•œ ì¦ê±° ê´€ë¦¬ ë° í‘œì‹œ

```typescript
// src/client/components/EvidenceNotebook.tsx
interface EvidenceNotebookProps {
  evidence: Evidence[];
  collectedIds: string[];
  suspects: Suspect[];
}

function EvidenceNotebook({
  evidence,
  collectedIds,
  suspects
}: EvidenceNotebookProps) {
  const [selectedEvidence, setSelectedEvidence] = useState<Evidence | null>(null);
  const [filter, setFilter] = useState<FilterType>('all');
  const [sortBy, setSortBy] = useState<SortType>('discovery');
  
  const collectedEvidence = evidence.filter(e => 
    collectedIds.includes(e.id)
  );
  
  const filteredEvidence = applyFilter(collectedEvidence, filter);
  const sortedEvidence = applySort(filteredEvidence, sortBy);
  
  return (
    <div className="evidence-notebook">
      {!selectedEvidence ? (
        <>
          <EvidenceFilters
            filter={filter}
            onFilterChange={setFilter}
            sortBy={sortBy}
            onSortChange={setSortBy}
          />
          <EvidenceGrid
            evidence={sortedEvidence}
            onSelect={setSelectedEvidence}
          />
        </>
      ) : (
        <EvidenceDetail
          evidence={selectedEvidence}
          suspects={suspects}
          onBack={() => setSelectedEvidence(null)}
        />
      )}
    </div>
  );
}
```

**í•˜ìœ„ ì»´í¬ë„ŒíŠ¸**:

```typescript
// EvidenceGrid - ì¦ê±° ê·¸ë¦¬ë“œ
function EvidenceGrid({ evidence, onSelect }) {
  return (
    <div className="grid grid-cols-3 gap-4">
      {evidence.map(ev => (
        <EvidenceCard
          key={ev.id}
          evidence={ev}
          onClick={() => onSelect(ev)}
        />
      ))}
    </div>
  );
}

// EvidenceCard - ê°œë³„ ì¦ê±° ì¹´ë“œ
function EvidenceCard({ evidence, onClick }) {
  return (
    <div className="evidence-card" onClick={onClick}>
      <img src={evidence.imageUrl} alt={evidence.name} />
      <h4>{evidence.name}</h4>
      <div className="evidence-meta">
        <span className="location">ğŸ“ {evidence.locationId}</span>
        <span className="type">{evidence.clueType}</span>
      </div>
      {evidence.relatedSuspects.length > 0 && (
        <div className="related-suspects">
          {evidence.relatedSuspects.map(suspectId => (
            <SuspectIcon key={suspectId} suspectId={suspectId} />
          ))}
        </div>
      )}
    </div>
  );
}

// EvidenceDetail - ì¦ê±° ìƒì„¸ í™”ë©´
function EvidenceDetail({ evidence, suspects, onBack }) {
  return (
    <div className="evidence-detail">
      <button onClick={onBack}>â† ë’¤ë¡œ</button>
      <img src={evidence.imageUrl} alt={evidence.name} className="large" />
      <h2>{evidence.name}</h2>
      <p>{evidence.description}</p>
      
      <div className="evidence-info">
        <div>ğŸ“ ë°œê²¬ ì¥ì†Œ: {evidence.locationId}</div>
        <div>ğŸ” ì¦ê±° íƒ€ì…: {evidence.clueType}</div>
        <div>âš ï¸ ì˜ì‹¬ ìˆ˜ì¤€: {evidence.suspicionLevel}</div>
      </div>
      
      {evidence.relatedSuspects.length > 0 && (
        <div className="related-suspects-detail">
          <h3>ì—°ê´€ëœ ìš©ì˜ì</h3>
          {evidence.relatedSuspects.map(suspectId => {
            const suspect = suspects.find(s => s.id === suspectId);
            return (
              <SuspectCard key={suspectId} suspect={suspect} />
            );
          })}
        </div>
      )}
    </div>
  );
}
```

#### 3. SuspectProfile (ìš©ì˜ì í”„ë¡œí•„ - ê°œì„ )

**ì±…ì„**: í”„ë¡œí•„ ì‚¬ì§„ í¬í•¨ ìš©ì˜ì ì •ë³´ í‘œì‹œ

```typescript
// src/client/components/SuspectProfile.tsx
interface SuspectProfileProps {
  suspect: Suspect;
  relatedEvidence: Evidence[];
  onEvidenceClick: (evidenceId: string) => void;
}

function SuspectProfile({
  suspect,
  relatedEvidence,
  onEvidenceClick
}: SuspectProfileProps) {
  return (
    <div className="suspect-profile">
      <div className="profile-header">
        <img
          src={suspect.profileImageUrl}
          alt={suspect.name}
          className="profile-image"
        />
        <div className="profile-info">
          <h2>{suspect.name}</h2>
          <p className="background">{suspect.background}</p>
          <p className="personality">{suspect.personality}</p>
        </div>
      </div>
      
      {relatedEvidence.length > 0 && (
        <div className="related-evidence">
          <h3>ê´€ë ¨ ì¦ê±°</h3>
          <div className="evidence-list">
            {relatedEvidence.map(evidence => (
              <EvidenceThumbnail
                key={evidence.id}
                evidence={evidence}
                onClick={() => onEvidenceClick(evidence.id)}
              />
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
```


---

## ë°ì´í„° íë¦„

### 1. ê²Œì„ ìƒì„± í”Œë¡œìš° (ë°±ì—”ë“œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê²Œì„ ìƒì„± ì‹œì‘                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ê¸°ì¡´ ìš”ì†Œ ì„ íƒ (ê²°ì •ë¡ ì )                             â”‚
â”‚ - ë¬´ê¸°, ë™ê¸°, ëŒ€í‘œ ì¥ì†Œ, ìš©ì˜ì ì›í˜•                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ìŠ¤í† ë¦¬ ìƒì„± (ë¹„ê²°ì •ë¡ ì )                              â”‚
â”‚ - í”¼í•´ì, ìš©ì˜ì 3ëª…, í•´ê²°ì±…                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ì¥ì†Œ ìƒì„± (NEW)                                      â”‚
â”‚ - LocationGenerator.generateLocations()                      â”‚
â”‚ - ëŒ€í‘œ ì¥ì†Œ 1ê°œ + íƒìƒ‰ ê°€ëŠ¥ ì¥ì†Œ 4ê°œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ì¦ê±° ìƒì„± (NEW)                                      â”‚
â”‚ - EvidenceGenerator.generateEvidence()                       â”‚
â”‚ - ì§„ë²” ì¦ê±° 3-5ê°œ + ë‹¤ë¥¸ ìš©ì˜ì ì¦ê±° + Red Herring 2-3ê°œ     â”‚
â”‚ - Three Clue Rule ê²€ì¦                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ì´ë¯¸ì§€ ìƒì„± (NEW - ë¹„ë™ê¸°)                            â”‚
â”‚ - ImageGenerator.generateAllImages()                         â”‚
â”‚ - ìš©ì˜ì í”„ë¡œí•„ (3-4ê°œ)                                       â”‚
â”‚ - ì¥ì†Œ ì´ë¯¸ì§€ (5ê°œ)                                           â”‚
â”‚ - ì¦ê±° ì´ë¯¸ì§€ (10-15ê°œ)                                       â”‚
â”‚ - ë³‘ë ¬ ì²˜ë¦¬, ì‹¤íŒ¨ ì‹œ í”Œë ˆì´ìŠ¤í™€ë”                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: ë°ì´í„° ì €ì¥                                           â”‚
â”‚ - CaseRepository.createCase()                                â”‚
â”‚ - ëª¨ë“  ë°ì´í„° (ì¥ì†Œ, ì¦ê±°, ì´ë¯¸ì§€ URL í¬í•¨)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê²Œì„ ìƒì„± ì™„ë£Œ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. í”Œë ˆì´ì–´ ìƒí˜¸ì‘ìš© í”Œë¡œìš° (í”„ë¡ íŠ¸ì—”ë“œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê²Œì„ ì‹œì‘                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë©”ì¸ ë©”ë‰´                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ìš©ì˜ì ëŒ€í™”  â”‚ ì¥ì†Œ íƒìƒ‰    â”‚ ì¦ê±° ë…¸íŠ¸ë¶  â”‚ ì¶”ë¦¬ ì œì¶œ    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚              â”‚
         â”‚              â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ìš©ì˜ì ëª©ë¡   â”‚ â”‚ ì¥ì†Œ ëª©ë¡     â”‚ â”‚ ìˆ˜ì§‘í•œ ì¦ê±°   â”‚ â”‚ ì¶”ë¦¬ ì–‘ì‹     â”‚
â”‚ (í”„ë¡œí•„ ì‚¬ì§„) â”‚ â”‚ (ì¥ì†Œ ì´ë¯¸ì§€) â”‚ â”‚ (ì¦ê±° ì´ë¯¸ì§€) â”‚ â”‚ (ì¦ê±° ì„ íƒ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚              â”‚
         â–¼              â–¼              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚
â”‚ ëŒ€í™” í™”ë©´     â”‚ â”‚ ì¥ì†Œ ìƒì„¸     â”‚    â”‚              â”‚
â”‚ (AI ì±„íŒ…)    â”‚ â”‚ (ì¦ê±° ë°œê²¬)   â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚
                        â”‚              â”‚              â”‚
                        â–¼              â”‚              â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚
                 â”‚ ì¦ê±° ìˆ˜ì§‘     â”‚â”€â”€â”€â”€â”˜              â”‚
                 â”‚ (ì¸ë²¤í† ë¦¬ ì¶”ê°€)â”‚                   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                                                    â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ ì¶”ë¦¬ ì œì¶œ     â”‚
                                          â”‚ (ì •ë‹µ í™•ì¸)   â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì¸í„°í˜ì´ìŠ¤ ë° API

### ë°±ì—”ë“œ API

#### 1. ê²Œì„ ìƒì„± API (í™•ì¥)

```typescript
// POST /api/generate-case
interface GenerateCaseRequest {
  date?: string;  // ì„ íƒì , ê¸°ë³¸ê°’: ì˜¤ëŠ˜
}

interface GenerateCaseResponse {
  caseId: string;
  date: string;
  victim: Victim;
  weapon: Weapon;
  motive: Motive;
  suspects: Suspect[];  // profileImageUrl í¬í•¨
  locations: Location[];  // 5ê°œ (ëŒ€í‘œ 1ê°œ + íƒìƒ‰ 4ê°œ)
  evidence: Evidence[];  // 10-15ê°œ
  solution: Solution;
  generatedAt: number;
}
```

#### 2. ì¦ê±° ìˆ˜ì§‘ API (NEW)

```typescript
// POST /api/collect-evidence
interface CollectEvidenceRequest {
  caseId: string;
  evidenceId: string;
  userId: string;
}

interface CollectEvidenceResponse {
  success: boolean;
  evidence: Evidence;
  collectedAt: number;
}
```

#### 3. í”Œë ˆì´ì–´ ì§„í–‰ ìƒí™© API (NEW)

```typescript
// GET /api/player-progress/:caseId/:userId
interface PlayerProgressResponse {
  caseId: string;
  userId: string;
  collectedEvidenceIds: string[];
  visitedLocationIds: string[];
  conversationHistory: ConversationMessage[];
  submittedSolution?: SubmittedSolution;
}
```

### í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ ê´€ë¦¬

```typescript
// ê²Œì„ ìƒíƒœ
interface GameState {
  case: GeneratedCase | null;
  collectedEvidenceIds: string[];
  visitedLocationIds: string[];
  selectedTab: 'suspects' | 'locations' | 'evidence' | 'solution';
  loading: boolean;
  error: string | null;
}

// ì•¡ì…˜
type GameAction =
  | { type: 'LOAD_CASE'; payload: GeneratedCase }
  | { type: 'COLLECT_EVIDENCE'; payload: string }
  | { type: 'VISIT_LOCATION'; payload: string }
  | { type: 'CHANGE_TAB'; payload: GameState['selectedTab'] }
  | { type: 'SET_LOADING'; payload: boolean }
  | { type: 'SET_ERROR'; payload: string };
```

---

## ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### 1. ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨

**ë¬¸ì œ**: Gemini API ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨ ë˜ëŠ” íƒ€ì„ì•„ì›ƒ

**í•´ê²°ì±…**:
```typescript
async function generateImageWithFallback(
  prompt: string,
  entityType: 'suspect' | 'location' | 'evidence'
): Promise<string> {
  try {
    const result = await geminiClient.generateImage(prompt);
    return result.imageUrl;
  } catch (error) {
    console.error(`ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨ (${entityType}):`, error);
    
    // í”Œë ˆì´ìŠ¤í™€ë” ì´ë¯¸ì§€ ë°˜í™˜
    return getPlaceholderImage(entityType);
  }
}

function getPlaceholderImage(entityType: string): string {
  const placeholders = {
    suspect: '/images/placeholder-suspect.png',
    location: '/images/placeholder-location.png',
    evidence: '/images/placeholder-evidence.png'
  };
  
  return placeholders[entityType] || '/images/placeholder-default.png';
}
```

### 2. Three Clue Rule ê²€ì¦ ì‹¤íŒ¨

**ë¬¸ì œ**: ìƒì„±ëœ ì¦ê±°ê°€ Three Clue Ruleì„ ë§Œì¡±í•˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
```typescript
function validateThreeClueRule(
  evidence: Evidence[],
  suspects: Suspect[]
): ValidationResult {
  const guiltyS suspect = suspects.find(s => s.isGuilty);
  if (!guiltySuspect) {
    return { valid: false, error: 'ì§„ë²”ì´ ì—†ìŠµë‹ˆë‹¤' };
  }
  
  const guiltyEvidence = evidence.filter(e =>
    e.relatedSuspects.includes(guiltySuspect.id) &&
    e.suspicionLevel === 'high'
  );
  
  if (guiltyEvidence.length < 3) {
    return {
      valid: false,
      error: `ì§„ë²” ì¦ê±° ë¶€ì¡±: ${guiltyEvidence.length}/3`
    };
  }
  
  return { valid: true };
}

// ì¬ìƒì„± ë¡œì§
async function generateEvidenceWithRetry(
  suspects: Suspect[],
  locations: Location[],
  solution: Solution,
  maxRetries: number = 3
): Promise<Evidence[]> {
  for (let i = 0; i < maxRetries; i++) {
    const evidence = await evidenceGenerator.generateEvidence(
      suspects,
      locations,
      solution
    );
    
    const validation = validateThreeClueRule(evidence, suspects);
    if (validation.valid) {
      return evidence;
    }
    
    console.warn(`ì¬ì‹œë„ ${i + 1}/${maxRetries}: ${validation.error}`);
  }
  
  throw new Error('Three Clue Rule ë§Œì¡± ì‹¤íŒ¨');
}
```

### 3. í”„ë¡ íŠ¸ì—”ë“œ ë¡œë”© ìƒíƒœ

**ë¬¸ì œ**: ì´ë¯¸ì§€ ë¡œë”© ì¤‘ ë¹ˆ í™”ë©´

**í•´ê²°ì±…**:
```typescript
function ImageWithLoading({ src, alt, className }: ImageProps) {
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);
  
  return (
    <div className={`image-container ${className}`}>
      {loading && <LoadingSpinner />}
      {error && <PlaceholderImage />}
      <img
        src={src}
        alt={alt}
        onLoad={() => setLoading(false)}
        onError={() => {
          setLoading(false);
          setError(true);
        }}
        style={{ display: loading || error ? 'none' : 'block' }}
      />
    </div>
  );
}
```


---

## í…ŒìŠ¤íŒ… ì „ëµ

### 1. ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸

#### ì¥ì†Œ ìƒì„± í…ŒìŠ¤íŠ¸
```typescript
describe('LocationGenerator', () => {
  it('should generate 5 locations (1 main + 4 explorable)', async () => {
    const locations = await locationGenerator.generateLocations(context, seed);
    
    expect(locations).toHaveLength(5);
    expect(locations.filter(l => l.isMainLocation)).toHaveLength(1);
    expect(locations.filter(l => !l.isMainLocation)).toHaveLength(4);
  });
  
  it('should assign evidence to locations', async () => {
    const locations = await locationGenerator.generateLocations(context, seed);
    
    locations.forEach(location => {
      expect(location.evidenceIds.length).toBeGreaterThanOrEqual(2);
      expect(location.evidenceIds.length).toBeLessThanOrEqual(4);
    });
  });
});
```

#### ì¦ê±° ìƒì„± í…ŒìŠ¤íŠ¸
```typescript
describe('EvidenceGenerator', () => {
  it('should satisfy Three Clue Rule', async () => {
    const evidence = await evidenceGenerator.generateEvidence(
      suspects,
      locations,
      solution
    );
    
    const validation = validateThreeClueRule(evidence, suspects);
    expect(validation.valid).toBe(true);
  });
  
  it('should generate 10-15 evidence items', async () => {
    const evidence = await evidenceGenerator.generateEvidence(
      suspects,
      locations,
      solution
    );
    
    expect(evidence.length).toBeGreaterThanOrEqual(10);
    expect(evidence.length).toBeLessThanOrEqual(15);
  });
  
  it('should include 2-3 red herrings', async () => {
    const evidence = await evidenceGenerator.generateEvidence(
      suspects,
      locations,
      solution
    );
    
    const redHerrings = evidence.filter(e => e.isRedHerring);
    expect(redHerrings.length).toBeGreaterThanOrEqual(2);
    expect(redHerrings.length).toBeLessThanOrEqual(3);
  });
});
```

#### ì´ë¯¸ì§€ ìƒì„± í…ŒìŠ¤íŠ¸
```typescript
describe('ImageGenerator', () => {
  it('should generate images with Ghibli style', async () => {
    const imageUrl = await imageGenerator.generateSuspectImage(suspect);
    
    expect(imageUrl).toBeTruthy();
    expect(imageUrl).toMatch(/^data:image|^https?:\/\//);
  });
  
  it('should handle generation failures gracefully', async () => {
    // Mock API failure
    jest.spyOn(geminiClient, 'generateImage').mockRejectedValue(new Error('API Error'));
    
    const imageUrl = await imageGenerator.generateSuspectImage(suspect);
    
    // Should return placeholder
    expect(imageUrl).toContain('placeholder');
  });
});
```

### 2. í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸

#### ì¥ì†Œ íƒìƒ‰ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
```typescript
describe('LocationExplorer', () => {
  it('should display all locations', () => {
    render(<LocationExplorer locations={mockLocations} />);
    
    expect(screen.getAllByRole('button')).toHaveLength(4);
  });
  
  it('should show location detail on click', () => {
    render(<LocationExplorer locations={mockLocations} />);
    
    fireEvent.click(screen.getByText('ë°€ì‹¤ ì„œì¬'));
    
    expect(screen.getByText('ë°œê²¬ ê°€ëŠ¥í•œ ì¦ê±°')).toBeInTheDocument();
  });
});
```

#### ì¦ê±° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸
```typescript
describe('EvidenceNotebook', () => {
  it('should display collected evidence', () => {
    render(
      <EvidenceNotebook
        evidence={mockEvidence}
        collectedIds={['ev-1', 'ev-2']}
      />
    );
    
    expect(screen.getAllByRole('article')).toHaveLength(2);
  });
  
  it('should filter evidence by location', () => {
    render(<EvidenceNotebook evidence={mockEvidence} />);
    
    fireEvent.click(screen.getByText('ì¥ì†Œë³„'));
    fireEvent.click(screen.getByText('ë°€ì‹¤ ì„œì¬'));
    
    // Only evidence from study should be shown
    expect(screen.getAllByRole('article')).toHaveLength(3);
  });
});
```

### 3. í†µí•© í…ŒìŠ¤íŠ¸

```typescript
describe('Full Game Flow', () => {
  it('should generate complete game with all elements', async () => {
    const game = await caseGenerator.generateCase({ date: '2025-01-15' });
    
    // ê¸°ë³¸ ìš”ì†Œ
    expect(game.victim).toBeDefined();
    expect(game.suspects).toHaveLength(3);
    expect(game.weapon).toBeDefined();
    
    // ìƒˆ ìš”ì†Œ
    expect(game.locations).toHaveLength(5);
    expect(game.evidence.length).toBeGreaterThanOrEqual(10);
    
    // ì´ë¯¸ì§€
    game.suspects.forEach(s => {
      expect(s.profileImageUrl).toBeTruthy();
    });
    game.locations.forEach(l => {
      expect(l.imageUrl).toBeTruthy();
    });
    game.evidence.forEach(e => {
      expect(e.imageUrl).toBeTruthy();
    });
    
    // Three Clue Rule
    const validation = validateThreeClueRule(game.evidence, game.suspects);
    expect(validation.valid).toBe(true);
  });
});
```

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ì´ë¯¸ì§€ ìƒì„± ìµœì í™”

**ë³‘ë ¬ ì²˜ë¦¬**:
```typescript
async function generateAllImages(
  suspects: Suspect[],
  locations: Location[],
  evidence: Evidence[]
): Promise<void> {
  // ë°°ì¹˜ í¬ê¸° ì œí•œ (ë™ì‹œ ìš”ì²­ 5ê°œ)
  const BATCH_SIZE = 5;
  
  const allTasks = [
    ...suspects.map(s => () => this.generateSuspectImage(s)),
    ...locations.map(l => () => this.generateLocationImage(l)),
    ...evidence.map(e => () => this.generateEvidenceImage(e))
  ];
  
  // ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì²˜ë¦¬
  for (let i = 0; i < allTasks.length; i += BATCH_SIZE) {
    const batch = allTasks.slice(i, i + BATCH_SIZE);
    await Promise.allSettled(batch.map(task => task()));
  }
}
```

**ìºì‹±**:
```typescript
// ê°™ì€ í”„ë¡¬í”„íŠ¸ëŠ” ìºì‹œëœ ì´ë¯¸ì§€ ì¬ì‚¬ìš©
const imageCache = new Map<string, string>();

async function generateImageWithCache(prompt: string): Promise<string> {
  const cacheKey = hashPrompt(prompt);
  
  if (imageCache.has(cacheKey)) {
    return imageCache.get(cacheKey)!;
  }
  
  const imageUrl = await geminiClient.generateImage(prompt);
  imageCache.set(cacheKey, imageUrl);
  
  return imageUrl;
}
```

### 2. í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”

**Lazy Loading**:
```typescript
function LocationGrid({ locations }: LocationGridProps) {
  return (
    <div className="grid">
      {locations.map(location => (
        <LazyLoad key={location.id} height={200} offset={100}>
          <LocationCard location={location} />
        </LazyLoad>
      ))}
    </div>
  );
}
```

**ì´ë¯¸ì§€ ìµœì í™”**:
```typescript
// ì¸ë„¤ì¼ê³¼ ì›ë³¸ ë¶„ë¦¬
interface OptimizedImage {
  thumbnail: string;  // 200x200px
  full: string;       // 800x600px
}

// ì¸ë„¤ì¼ ë¨¼ì € ë¡œë“œ, í´ë¦­ ì‹œ ì›ë³¸ ë¡œë“œ
function EvidenceCard({ evidence }: EvidenceCardProps) {
  const [showFull, setShowFull] = useState(false);
  
  return (
    <div onClick={() => setShowFull(true)}>
      <img
        src={showFull ? evidence.imageUrl : evidence.thumbnailUrl}
        alt={evidence.name}
      />
    </div>
  );
}
```

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì´ë¯¸ì§€ ìƒì„± í”„ë¡¬í”„íŠ¸ ê²€ì¦

```typescript
function sanitizePrompt(prompt: string): string {
  // ë¶€ì ì ˆí•œ í‚¤ì›Œë“œ í•„í„°ë§
  const blockedKeywords = ['explicit', 'violent', 'gore', ...];
  
  for (const keyword of blockedKeywords) {
    if (prompt.toLowerCase().includes(keyword)) {
      throw new Error(`ë¶€ì ì ˆí•œ í”„ë¡¬í”„íŠ¸: ${keyword}`);
    }
  }
  
  return prompt;
}
```

### 2. í”Œë ˆì´ì–´ ì§„í–‰ ìƒí™© ê²€ì¦

```typescript
// ì¦ê±° ìˆ˜ì§‘ ì‹œ ìœ íš¨ì„± ê²€ì¦
async function collectEvidence(
  caseId: string,
  evidenceId: string,
  userId: string
): Promise<void> {
  // 1. ì¼€ì´ìŠ¤ ì¡´ì¬ í™•ì¸
  const caseData = await CaseRepository.getCaseById(caseId);
  if (!caseData) {
    throw new Error('ì¼€ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  }
  
  // 2. ì¦ê±° ì¡´ì¬ í™•ì¸
  const evidence = caseData.evidence.find(e => e.id === evidenceId);
  if (!evidence) {
    throw new Error('ì¦ê±°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  }
  
  // 3. ì¤‘ë³µ ìˆ˜ì§‘ ë°©ì§€
  const progress = await getPlayerProgress(caseId, userId);
  if (progress.collectedEvidenceIds.includes(evidenceId)) {
    throw new Error('ì´ë¯¸ ìˆ˜ì§‘í•œ ì¦ê±°ì…ë‹ˆë‹¤');
  }
  
  // 4. ìˆ˜ì§‘ ê¸°ë¡
  await recordEvidenceCollection(caseId, userId, evidenceId);
}
```

---

## ë°°í¬ ë° ëª¨ë‹ˆí„°ë§

### 1. ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (GEMINI_API_KEY, VERCEL_IMAGE_FUNCTION_URL)
- [ ] ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë” íŒŒì¼ ì¤€ë¹„
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (Location, Evidence í…Œì´ë¸”)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ë° ë°°í¬
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ì´ë¯¸ì§€ ìƒì„± ì‹œê°„)
- [ ] ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„¤ì •

### 2. ëª¨ë‹ˆí„°ë§ ì§€í‘œ

```typescript
// ê²Œì„ ìƒì„± ë©”íŠ¸ë¦­
interface GameGenerationMetrics {
  totalTime: number;           // ì „ì²´ ìƒì„± ì‹œê°„
  locationGenerationTime: number;
  evidenceGenerationTime: number;
  imageGenerationTime: number;
  imageGenerationSuccessRate: number;
  threeClueRuleValidationRate: number;
}

// í”Œë ˆì´ì–´ í–‰ë™ ë©”íŠ¸ë¦­
interface PlayerBehaviorMetrics {
  averageEvidenceCollected: number;
  averageLocationsVisited: number;
  averageTimeToSolution: number;
  solutionAccuracyRate: number;
}
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

### Phase 1: ë°±ì—”ë“œ êµ¬í˜„ (1ì£¼)
1. LocationGenerator êµ¬í˜„
2. EvidenceGenerator êµ¬í˜„
3. ImageGenerator í†µí•©
4. Three Clue Rule ê²€ì¦
5. í…ŒìŠ¤íŠ¸ ì‘ì„±

### Phase 2: í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ (1ì£¼)
1. LocationExplorer ì»´í¬ë„ŒíŠ¸
2. EvidenceNotebook ì»´í¬ë„ŒíŠ¸
3. SuspectProfile ê°œì„ 
4. ìƒíƒœ ê´€ë¦¬ í†µí•©
5. UI/UX í…ŒìŠ¤íŠ¸

### Phase 3: í†µí•© ë° í…ŒìŠ¤íŠ¸ (3ì¼)
1. ë°±ì—”ë“œ-í”„ë¡ íŠ¸ì—”ë“œ í†µí•©
2. ì „ì²´ ê²Œì„ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
3. ì„±ëŠ¥ ìµœì í™”
4. ë²„ê·¸ ìˆ˜ì •

### Phase 4: ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ (2ì¼)
1. í”„ë¡œë•ì…˜ ë°°í¬
2. ëª¨ë‹ˆí„°ë§ ì„¤ì •
3. ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘
4. ê°œì„  ì‚¬í•­ ë°˜ì˜

---

## ì°¸ê³  ë¬¸ì„œ

- `docs2.md/MURDER_MYSTERY_MASTER_GUIDE.md` - í•µì‹¬ ì›ì¹™
- `docs2.md/GAME_GENERATION_PROCESS.md` - í˜„ì¬ í”„ë¡œì„¸ìŠ¤
- `scripts/test-image-generation.ts` - ì´ë¯¸ì§€ ìƒì„± ë¡œì§
- `.kiro/specs/location-evidence-system/requirements.md` - ìš”êµ¬ì‚¬í•­

---

**ì„¤ê³„ ë²„ì „**: 1.0  
**ì‘ì„±ì¼**: 2025-01-15  
**ìƒíƒœ**: ê²€í†  ëŒ€ê¸°

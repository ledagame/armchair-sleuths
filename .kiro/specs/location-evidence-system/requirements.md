# 장소 탐색 및 증거 수집 시스템 요구사항

## 개요

현재 게임은 용의자와의 대화만 가능합니다. 이 기능은 장소 탐색과 증거 수집 시스템을 추가하여 게임의 깊이와 재미를 크게 향상시킵니다. 모든 요소(장소, 증거, 용의자)는 지브리 애니메이션 스타일의 이미지와 함께 제공됩니다.

**품질 목표**: 100점 만점에 80-90점 수준의 완성도
**핵심 원칙**: MURDER_MYSTERY_MASTER_GUIDE.md의 Fair Play, Three Clue Rule, Gumshoe 원칙 준수

---

## Requirement 1: 장소 생성 시스템

**User Story**: 게임 마스터로서, 플레이어가 탐색할 수 있는 다양한 장소를 제공하여 게임의 깊이를 더하고 싶습니다.

### Acceptance Criteria

1. WHEN 게임이 생성될 때 THEN 시스템은 1개의 대표 장소와 4개의 탐색 가능한 장소를 비결정론적으로 생성해야 합니다.

2. WHEN 장소가 생성될 때 THEN 각 장소는 다음 정보를 포함해야 합니다:
   - 고유 ID
   - 이름 (스토리와 연관)
   - 상세 설명
   - 지브리 스타일 이미지 URL
   - 발견 가능한 증거 ID 목록
   - 대표 장소 여부 플래그

3. WHEN 장소가 생성될 때 THEN 각 장소는 게임의 스토리, 배경, 시대와 논리적으로 연결되어야 합니다.

4. WHEN 장소가 생성될 때 THEN 각 장소는 최소 2-4개의 증거를 포함해야 합니다.

---

## Requirement 2: 증거 생성 시스템

**User Story**: 게임 마스터로서, 플레이어가 수집하고 분석할 수 있는 의미 있는 증거를 제공하여 추리 게임의 핵심을 구현하고 싶습니다.

### Acceptance Criteria

1. WHEN 게임이 생성될 때 THEN 시스템은 10-15개의 증거를 비결정론적으로 생성해야 합니다.

2. WHEN 증거가 생성될 때 THEN 각 증거는 다음 정보를 포함해야 합니다:
   - 고유 ID
   - 이름
   - 상세 설명
   - 지브리 스타일 이미지 URL
   - 발견 장소 ID
   - 연관된 용의자 ID 목록
   - 의심 수준 (high/medium/low)
   - Red Herring 여부
   - 증거 타입 (physical/document/testimony/digital)

3. WHEN 증거가 생성될 때 THEN Three Clue Rule을 준수해야 합니다:
   - 각 용의자당 최소 3개의 독립적 단서
   - 진범에게 불리한 증거 3-5개
   - 다른 용의자들에게도 불리한 증거 분배

4. WHEN 증거가 생성될 때 THEN 2-3개의 Red Herring(의미 있는 허위 단서)을 포함해야 합니다.

5. WHEN 증거가 생성될 때 THEN 각 증거는 발견 장소와 논리적으로 연결되어야 합니다.

---

## Requirement 3: 이미지 생성 통합

**User Story**: 플레이어로서, 시각적으로 매력적인 지브리 스타일의 이미지를 통해 게임에 더 몰입하고 싶습니다.

### Acceptance Criteria

1. WHEN 게임이 생성될 때 THEN 시스템은 다음 이미지들을 자동으로 생성해야 합니다:
   - 각 용의자의 프로필 사진 (3-4개)
   - 각 장소의 이미지 (4개)
   - 각 증거의 이미지 (10-15개)

2. WHEN 이미지가 생성될 때 THEN 모든 이미지는 지브리 애니메이션 스타일을 따라야 합니다:
   - 부드러운 수채화 느낌
   - 따뜻한 조명
   - 손으로 그린 애니메이션 품질
   - 기발하면서도 미스터리한 분위기
   - 머더 미스터리 게임에 적합

3. WHEN 용의자 이미지가 생성될 때 THEN 얼굴 중심의 초상화 형태여야 하며 각 캐릭터의 개성을 반영해야 합니다.

4. WHEN 장소 이미지가 생성될 때 THEN 탐색 가능한 공간을 보여주며 증거가 숨겨질 만한 디테일을 포함해야 합니다.

5. WHEN 증거 이미지가 생성될 때 THEN 클로즈업 형태로 명확한 디테일을 보여주며 각 증거의 특징을 강조해야 합니다.

6. WHEN 이미지 생성이 실패할 때 THEN 시스템은 기본 플레이스홀더 이미지를 제공하고 에러를 로깅해야 합니다.

---

## Requirement 4: 장소 탐색 UI

**User Story**: 플레이어로서, 직관적인 UI를 통해 다양한 장소를 탐색하고 증거를 발견하고 싶습니다.

### Acceptance Criteria

1. WHEN 플레이어가 게임 화면에 접근할 때 THEN "장소 탐색" 메뉴/탭이 표시되어야 합니다.

2. WHEN 플레이어가 장소 탐색 화면을 열 때 THEN 4개의 탐색 가능한 장소가 카드 형태로 표시되어야 합니다:
   - 장소 이미지
   - 장소 이름
   - 간단한 설명
   - 발견 가능한 증거 수 (미발견/전체)

3. WHEN 플레이어가 장소 카드를 클릭할 때 THEN 장소 상세 화면이 열려야 합니다:
   - 큰 장소 이미지
   - 상세 설명
   - 발견 가능한 증거 목록
   - 각 증거 클릭 시 수집 가능

4. WHEN 플레이어가 증거를 클릭할 때 THEN 증거 상세 정보가 표시되어야 합니다:
   - 증거 이미지
   - 증거 이름 및 설명
   - "수집하기" 버튼

5. WHEN 플레이어가 증거를 수집할 때 THEN 증거가 인벤토리에 추가되고 시각적 피드백이 제공되어야 합니다.

---

## Requirement 5: 증거 관리 시스템

**User Story**: 플레이어로서, 수집한 증거를 체계적으로 관리하고 분석하여 범인을 추리하고 싶습니다.

### Acceptance Criteria

1. WHEN 플레이어가 게임 화면에 접근할 때 THEN "증거 노트북" 메뉴/탭이 표시되어야 합니다.

2. WHEN 플레이어가 증거 노트북을 열 때 THEN 수집한 모든 증거가 목록으로 표시되어야 합니다:
   - 증거 썸네일 이미지
   - 증거 이름
   - 발견 장소
   - 연관된 용의자 (아이콘 또는 이름)

3. WHEN 플레이어가 증거를 클릭할 때 THEN 증거 상세 화면이 열려야 합니다:
   - 큰 증거 이미지
   - 상세 설명
   - 발견 장소 정보
   - 연관된 용의자 목록
   - 플레이어 메모 입력 가능 (선택적)

4. WHEN 플레이어가 증거 노트북을 볼 때 THEN 증거를 필터링/정렬할 수 있어야 합니다:
   - 장소별
   - 용의자별
   - 증거 타입별
   - 수집 순서

5. WHEN 플레이어가 증거를 수집할 때 THEN 수집 시각과 장소가 기록되어야 합니다.

---

## Requirement 6: 용의자 프로필 개선

**User Story**: 플레이어로서, 용의자의 프로필 사진을 보며 더 생생하게 캐릭터를 인식하고 싶습니다.

### Acceptance Criteria

1. WHEN 용의자 목록이 표시될 때 THEN 각 용의자의 프로필 사진이 함께 표시되어야 합니다.

2. WHEN 용의자와 대화할 때 THEN 대화 화면에 용의자의 프로필 사진이 표시되어야 합니다.

3. WHEN 용의자 상세 프로필을 볼 때 THEN 큰 프로필 사진과 함께 다음 정보가 표시되어야 합니다:
   - 이름, 나이, 직업
   - 배경 스토리
   - 관련 증거 목록
   - 대화 기록

4. WHEN 증거가 용의자와 연관될 때 THEN 증거 화면에서 해당 용의자의 작은 프로필 사진이 표시되어야 합니다.

---

## Requirement 7: 데이터 구조 및 백엔드 통합

**User Story**: 개발자로서, 장소와 증거 데이터가 체계적으로 저장되고 관리되어야 합니다.

### Acceptance Criteria

1. WHEN 게임이 생성될 때 THEN 다음 데이터 구조가 생성되어야 합니다:

```typescript
interface Location {
  id: string;
  name: string;
  description: string;
  imageUrl: string;
  evidenceIds: string[];
  isMainLocation: boolean;
}

interface Evidence {
  id: string;
  name: string;
  description: string;
  imageUrl: string;
  locationId: string;
  relatedSuspects: string[];
  suspicionLevel: 'high' | 'medium' | 'low';
  isRedHerring: boolean;
  clueType: 'physical' | 'document' | 'testimony' | 'digital';
}

interface Suspect {
  // ... 기존 필드
  profileImageUrl: string;
}
```

2. WHEN 게임 데이터가 저장될 때 THEN 장소, 증거, 이미지 URL이 모두 포함되어야 합니다.

3. WHEN 프론트엔드가 데이터를 요청할 때 THEN 백엔드는 완전한 게임 데이터를 반환해야 합니다:
   - 용의자 목록 (프로필 이미지 포함)
   - 장소 목록 (이미지 포함)
   - 증거 목록 (이미지 포함)
   - 관계 매핑 (증거-장소, 증거-용의자)

4. WHEN 플레이어가 증거를 수집할 때 THEN 수집 상태가 저장되어야 합니다.

---

## Requirement 8: 게임 플로우 통합

**User Story**: 플레이어로서, 장소 탐색, 증거 수집, 용의자 대화가 자연스럽게 통합된 게임 경험을 원합니다.

### Acceptance Criteria

1. WHEN 플레이어가 게임을 시작할 때 THEN 다음 메뉴가 제공되어야 합니다:
   - 용의자 대화
   - 장소 탐색
   - 증거 노트북
   - 추리 제출

2. WHEN 플레이어가 증거를 수집할 때 THEN 용의자 대화에서 해당 증거를 언급할 수 있어야 합니다 (선택적).

3. WHEN 플레이어가 추리를 제출할 때 THEN 수집한 증거가 추리 근거로 활용될 수 있어야 합니다.

4. WHEN 게임이 종료될 때 THEN 플레이어가 발견한 증거와 놓친 증거가 표시되어야 합니다.

---

## Requirement 9: 성능 및 로딩

**User Story**: 플레이어로서, 이미지가 많아도 게임이 빠르게 로드되고 부드럽게 작동하기를 원합니다.

### Acceptance Criteria

1. WHEN 게임이 생성될 때 THEN 이미지 생성은 비동기로 처리되어야 하며 게임 생성을 블로킹하지 않아야 합니다.

2. WHEN 이미지가 로딩 중일 때 THEN 플레이스홀더 또는 로딩 스피너가 표시되어야 합니다.

3. WHEN 이미지가 로드될 때 THEN 이미지는 적절한 크기로 최적화되어야 합니다:
   - 썸네일: 200x200px
   - 상세 이미지: 800x600px

4. WHEN 플레이어가 장소나 증거를 탐색할 때 THEN 이미지는 lazy loading으로 필요할 때만 로드되어야 합니다.

---

## Requirement 10: 품질 및 Fair Play

**User Story**: 게임 디자이너로서, 게임이 공정하고 논리적이며 재미있어야 합니다.

### Acceptance Criteria

1. WHEN 게임이 생성될 때 THEN Three Clue Rule이 준수되어야 합니다:
   - 진범에 대한 최소 3개의 독립적 단서
   - 각 단서는 다른 장소에서 발견 가능

2. WHEN 증거가 배치될 때 THEN Fair Play 원칙이 준수되어야 합니다:
   - 모든 증거가 플레이어에게 접근 가능
   - 숨겨진 정보 없음
   - 논리적 추론으로 해결 가능

3. WHEN 게임이 생성될 때 THEN Gumshoe 원칙이 적용되어야 합니다:
   - 증거 찾기는 쉬움 (장소 탐색만 하면 됨)
   - 증거 해석은 어려움 (플레이어가 연결해야 함)

4. WHEN Red Herring이 생성될 때 THEN 의미 있는 허위 단서여야 합니다:
   - 스토리에 기여
   - 미스디렉션 제공
   - 최종적으로 해명 가능

5. WHEN 게임 품질을 평가할 때 THEN 다음 기준을 충족해야 합니다:
   - 논리적 일관성: 모든 증거가 스토리와 연결
   - 재미: 탐색과 발견의 즐거움
   - 공정성: 플레이어가 해결 가능
   - 완성도: 80-90점 수준

---

## 비기능적 요구사항

### 성능
- 게임 생성 시간: 3분 이내 (이미지 생성 포함)
- 이미지 로딩: 2초 이내
- UI 반응성: 즉각적 (<100ms)

### 호환성
- 모든 주요 브라우저 지원
- 모바일 반응형 디자인
- Reddit Devvit 플랫폼 호환

### 유지보수성
- 명확한 데이터 구조
- 타입 안전성 (TypeScript)
- 에러 처리 및 로깅
- 테스트 가능한 코드

---

## 제외 사항 (Out of Scope)

다음 기능은 이번 구현에서 제외하며, 향후 개선 시 고려합니다:

- 추리 보드 (증거 연결 시각화)
- 타임라인 재구성 도구
- 힌트 시스템
- 멀티플레이어 기능
- 증거 분석 미니게임
- 음성/음향 효과

---

## 성공 지표

이 기능이 성공적으로 구현되었다고 판단하는 기준:

1. ✅ 플레이어가 4개 장소를 탐색하고 10-15개 증거를 수집할 수 있음
2. ✅ 모든 이미지가 지브리 스타일로 생성되고 표시됨
3. ✅ Three Clue Rule 준수 (각 용의자당 3+ 단서)
4. ✅ Fair Play 원칙 준수 (모든 증거 접근 가능)
5. ✅ 게임 플로우가 자연스럽고 직관적
6. ✅ 80-90점 품질 기준 달성
7. ✅ 테스트 플레이어가 "재미있다"고 평가

---

## 참고 문서

- `docs2.md/MURDER_MYSTERY_MASTER_GUIDE.md` - 핵심 원칙 및 품질 기준
- `docs2.md/MYSTERY_INFORMATION_COLLECTION_SYSTEM.md` - 증거 수집 시스템 설계
- `docs2.md/GAME_GENERATION_PROCESS.md` - 현재 게임 생성 프로세스
- `scripts/test-image-generation.ts` - 이미지 생성 로직

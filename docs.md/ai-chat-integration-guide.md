# AI ì±„íŒ… ëŒ€í™” ì‹œìŠ¤í…œ í†µí•© ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-01-15  
**ë²„ì „**: 1.0  
**ëŒ€ìƒ**: Devvit í”Œë«í¼ ê¸°ë°˜ í”„ë¡œì íŠ¸  
**ëª©ì **: ì™¸ë¶€ AI APIë¥¼ Devvit í”„ë¡œì íŠ¸ì— í†µí•©í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œ

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [êµ¬í˜„ ê°€ì´ë“œ](#êµ¬í˜„-ê°€ì´ë“œ)
4. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)
5. [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
6. [í…ŒìŠ¤íŠ¸ ë°©ë²•](#í…ŒìŠ¤íŠ¸-ë°©ë²•)
7. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
8. [ì²´í¬ë¦¬ìŠ¤íŠ¸](#ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## ê°œìš”

### ëª©í‘œ
ì™¸ë¶€ì— ì´ë¯¸ êµ¬ì¶•ëœ AI ì±„íŒ… APIë¥¼ Devvit í”„ë¡œì íŠ¸ì— í†µí•©í•˜ì—¬ Reddit ì‚¬ìš©ìê°€ AIì™€ ëŒ€í™”í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•


### í•µì‹¬ ì›ì¹™
1. **í”„ë¡ì‹œ íŒ¨í„´**: Devvit ì„œë²„ë¥¼ í†µí•´ ì™¸ë¶€ API í˜¸ì¶œ
2. **íƒ€ì„ì•„ì›ƒ ê´€ë¦¬**: Devvit 30ì´ˆ ì œí•œ ì¤€ìˆ˜
3. **ì—ëŸ¬ ì²˜ë¦¬**: ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€
4. **ë³´ì•ˆ**: API í‚¤ ë³´í˜¸ ë° ì…ë ¥ ê²€ì¦

### ì „ì œ ì¡°ê±´
- ì™¸ë¶€ AI APIê°€ ì´ë¯¸ êµ¬ì¶•ë˜ì–´ ìˆìŒ
- API ì—”ë“œí¬ì¸íŠ¸ URL í™•ë³´
- API ìš”ì²­/ì‘ë‹µ í˜•ì‹ íŒŒì•…
- Devvit í”„ë¡œì íŠ¸ ê¸°ë³¸ êµ¬ì¡° ì™„ì„±

---

## ì•„í‚¤í…ì²˜ ì„¤ê³„

### 3-Tier ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Reddit User                               â”‚
â”‚  - ë¸Œë¼ìš°ì €ì—ì„œ Devvit ì•± ì‹¤í–‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Tier 1: Devvit Client (React)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ChatInterface Component                              â”‚    â”‚
â”‚  â”‚ - ë©”ì‹œì§€ ì…ë ¥/í‘œì‹œ                                    â”‚    â”‚
â”‚  â”‚ - ë¡œë”© ìƒíƒœ ê´€ë¦¬                                      â”‚    â”‚
â”‚  â”‚ - ì—ëŸ¬ í‘œì‹œ                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ fetch('/api/chat')
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Tier 2: Devvit Server (Proxy Layer) â­              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ /api/chat Endpoint                                   â”‚    â”‚
â”‚  â”‚ - íƒ€ì„ì•„ì›ƒ ê´€ë¦¬ (25ì´ˆ)                                â”‚    â”‚
â”‚  â”‚ - ì…ë ¥ ê²€ì¦                                           â”‚    â”‚
â”‚  â”‚ - Rate limiting                                       â”‚    â”‚
â”‚  â”‚ - ì—ëŸ¬ ì²˜ë¦¬                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ fetch('https://external-api.com/chat')
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Tier 3: External AI API (ì´ë¯¸ êµ¬ì¶•ë¨)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ /api/simple-chat                                     â”‚    â”‚
â”‚  â”‚ - AI ëª¨ë¸ í†µí•© (OpenAI, Anthropic ë“±)                â”‚    â”‚
â”‚  â”‚ - í”„ë¡¬í”„íŠ¸ ê´€ë¦¬                                       â”‚    â”‚
â”‚  â”‚ - ì‘ë‹µ ìƒì„±                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

```typescript
// 1. ì‚¬ìš©ì ì…ë ¥
User types: "ì•ˆë…•í•˜ì„¸ìš”"

// 2. Client â†’ Server
POST /api/chat
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”",
  "sessionId": "session-123"
}

// 3. Server â†’ External API
POST https://external-api.com/api/simple-chat
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”",
  "sessionId": "session-123"
}

// 4. External API â†’ Server
{
  "response": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
  "sessionId": "session-123"
}

// 5. Server â†’ Client
{
  "success": true,
  "response": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
  "sessionId": "session-123"
}

// 6. Client displays response
AI: "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
```

### Devvit ì œì•½ì‚¬í•­ í•´ê²°

| ì œì•½ì‚¬í•­ | í•´ê²° ë°©ë²• |
|---------|----------|
| í´ë¼ì´ì–¸íŠ¸ëŠ” ì™¸ë¶€ API í˜¸ì¶œ ë¶ˆê°€ | Devvit ì„œë²„ë¥¼ í”„ë¡ì‹œë¡œ ì‚¬ìš© |
| 30ì´ˆ íƒ€ì„ì•„ì›ƒ | 25ì´ˆë¡œ íƒ€ì„ì•„ì›ƒ ì„¤ì •, ì´ˆê³¼ ì‹œ ì—ëŸ¬ ë°˜í™˜ |
| ìŠ¤íŠ¸ë¦¬ë° ë¶ˆê°€ | ì „ì²´ ì‘ë‹µ ëŒ€ê¸° í›„ ë°˜í™˜ |
| ì„œë²„ë¦¬ìŠ¤ (ìƒíƒœ ìœ ì§€ ë¶ˆê°€) | Redisë¡œ ì„¸ì…˜ ê´€ë¦¬ |

---

## êµ¬í˜„ ê°€ì´ë“œ

### Phase 1: API ìŠ¤í™ í™•ì¸ (30ë¶„)

#### 1.1 API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
```bash
# API URL
https://your-api.vercel.app/api/simple-chat

# ë©”ì„œë“œ
POST

# Content-Type
application/json
```

#### 1.2 ìš”ì²­ í˜•ì‹ íŒŒì•…
```typescript
// ì¼ë°˜ì ì¸ ìš”ì²­ í˜•ì‹
interface ChatRequest {
  message: string;           // í•„ìˆ˜: ì‚¬ìš©ì ë©”ì‹œì§€
  sessionId?: string;        // ì„ íƒ: ì„¸ì…˜ ID
  userId?: string;           // ì„ íƒ: ì‚¬ìš©ì ID
  context?: any;             // ì„ íƒ: ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸
}
```

#### 1.3 ì‘ë‹µ í˜•ì‹ íŒŒì•…
```typescript
// ì¼ë°˜ì ì¸ ì‘ë‹µ í˜•ì‹
interface ChatResponse {
  response: string;          // AI ì‘ë‹µ
  sessionId?: string;        // ì„¸ì…˜ ID
  metadata?: {               // ì„ íƒ: ë©”íƒ€ë°ì´í„°
    model?: string;
    tokens?: number;
    timestamp?: number;
  };
}
```

#### 1.4 ì—ëŸ¬ ì‘ë‹µ íŒŒì•…
```typescript
// ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
interface ErrorResponse {
  error: string;             // ì—ëŸ¬ ë©”ì‹œì§€
  code?: string;             // ì—ëŸ¬ ì½”ë“œ
  details?: any;             // ìƒì„¸ ì •ë³´
}
```


### Phase 2: Devvit ì„œë²„ í”„ë¡ì‹œ êµ¬í˜„ (1ì‹œê°„)

#### 2.1 íƒ€ì… ì •ì˜
```typescript
// src/shared/types/chat.ts
export interface Message {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: number;
}

export interface ChatSession {
  id: string;
  userId: string;
  messages: Message[];
  createdAt: number;
  updatedAt: number;
}

export interface ChatRequest {
  message: string;
  sessionId?: string;
}

export interface ChatResponse {
  success: boolean;
  response?: string;
  sessionId?: string;
  error?: string;
}
```

#### 2.2 í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
```typescript
// src/server/api/chat.ts
import { Request, Response } from 'express';

const EXTERNAL_API_URL = process.env.EXTERNAL_API_URL || 
  'https://your-api.vercel.app/api/simple-chat';
const API_TIMEOUT = 25000; // 25ì´ˆ (Devvit 30ì´ˆ ì œí•œ ê³ ë ¤)

export async function handleChatRequest(req: Request, res: Response) {
  try {
    const { message, sessionId } = req.body;
    
    // 1. ì…ë ¥ ê²€ì¦
    const validation = validateInput(message);
    if (!validation.valid) {
      return res.status(400).json({
        success: false,
        error: validation.error
      });
    }
    
    // 2. Rate limiting ì²´í¬
    const rateLimitCheck = await checkRateLimit(req);
    if (!rateLimitCheck.allowed) {
      return res.status(429).json({
        success: false,
        error: 'ë„ˆë¬´ ë§ì€ ìš”ì²­ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
      });
    }
    
    // 3. ì™¸ë¶€ API í˜¸ì¶œ (íƒ€ì„ì•„ì›ƒ í¬í•¨)
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), API_TIMEOUT);
    
    try {
      const response = await fetch(EXTERNAL_API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${process.env.API_KEY}`, // API í‚¤ í•„ìš”ì‹œ
        },
        body: JSON.stringify({
          message,
          sessionId
        }),
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        throw new Error(`API Error: ${response.status} ${response.statusText}`);
      }
      
      const data = await response.json();
      
      // 4. ì‘ë‹µ ë°˜í™˜
      return res.json({
        success: true,
        response: data.response,
        sessionId: data.sessionId || sessionId
      });
      
    } catch (error) {
      clearTimeout(timeoutId);
      
      if (error.name === 'AbortError') {
        return res.status(504).json({
          success: false,
          error: 'ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë” ì§§ì€ ì§ˆë¬¸ì„ ì‹œë„í•´ì£¼ì„¸ìš”.'
        });
      }
      
      throw error;
    }
    
  } catch (error) {
    console.error('Chat proxy error:', error);
    return res.status(500).json({
      success: false,
      error: 'AI ì‘ë‹µì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
    });
  }
}

// ì…ë ¥ ê²€ì¦ í•¨ìˆ˜
function validateInput(message: string): { valid: boolean; error?: string } {
  if (!message || typeof message !== 'string') {
    return { valid: false, error: 'ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
  }
  
  if (message.trim().length === 0) {
    return { valid: false, error: 'ë¹ˆ ë©”ì‹œì§€ëŠ” ì „ì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' };
  }
  
  if (message.length > 1000) {
    return { valid: false, error: 'ë©”ì‹œì§€ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. (ìµœëŒ€ 1000ì)' };
  }
  
  // XSS ë°©ì§€
  const dangerousPatterns = [
    /<script/i,
    /javascript:/i,
    /on\w+=/i
  ];
  
  for (const pattern of dangerousPatterns) {
    if (pattern.test(message)) {
      return { valid: false, error: 'í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' };
    }
  }
  
  return { valid: true };
}

// Rate limiting ì²´í¬
async function checkRateLimit(req: Request): Promise<{ allowed: boolean }> {
  // Redis ë˜ëŠ” ë©”ëª¨ë¦¬ ê¸°ë°˜ rate limiting êµ¬í˜„
  // ì˜ˆ: 1ë¶„ì— 10ê°œ ìš”ì²­ ì œí•œ
  return { allowed: true }; // êµ¬í˜„ í•„ìš”
}
```

#### 2.3 ì„œë²„ì— ë¼ìš°íŠ¸ ë“±ë¡
```typescript
// src/server/index.ts
import express from 'express';
import { handleChatRequest } from './api/chat';

const app = express();

app.use(express.json());

// ì±„íŒ… API ì—”ë“œí¬ì¸íŠ¸
app.post('/api/chat', handleChatRequest);

export default app;
```


### Phase 3: í´ë¼ì´ì–¸íŠ¸ UI êµ¬í˜„ (2-3ì‹œê°„)

#### 3.1 ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ ì»´í¬ë„ŒíŠ¸
```typescript
// src/client/components/ChatInterface.tsx
import React, { useState, useRef, useEffect } from 'react';
import './ChatInterface.css';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: number;
}

export function ChatInterface() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [sessionId] = useState<string>(() => 
    `session-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`
  );
  
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLTextAreaElement>(null);
  
  // ìë™ ìŠ¤í¬ë¡¤
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);
  
  // ì…ë ¥ì°½ ìë™ í¬ì»¤ìŠ¤
  useEffect(() => {
    inputRef.current?.focus();
  }, []);
  
  const sendMessage = async () => {
    if (!input.trim() || loading) return;
    
    const userMessage: Message = {
      id: `msg-${Date.now()}`,
      role: 'user',
      content: input.trim(),
      timestamp: Date.now()
    };
    
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setLoading(true);
    setError(null);
    
    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          message: userMessage.content,
          sessionId
        })
      });
      
      const data = await response.json();
      
      if (!data.success) {
        throw new Error(data.error || 'ì‘ë‹µ ì‹¤íŒ¨');
      }
      
      const assistantMessage: Message = {
        id: `msg-${Date.now()}`,
        role: 'assistant',
        content: data.response,
        timestamp: Date.now()
      };
      
      setMessages(prev => [...prev, assistantMessage]);
      
    } catch (error) {
      console.error('Chat error:', error);
      const errorMsg = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
      setError(errorMsg);
      
      const errorMessage: Message = {
        id: `msg-${Date.now()}`,
        role: 'assistant',
        content: `ì£„ì†¡í•©ë‹ˆë‹¤. ${errorMsg}`,
        timestamp: Date.now()
      };
      setMessages(prev => [...prev, errorMessage]);
      
    } finally {
      setLoading(false);
      inputRef.current?.focus();
    }
  };
  
  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };
  
  return (
    <div className="chat-container">
      <div className="chat-header">
        <h2>AI ìš©ì˜ìì™€ ëŒ€í™”</h2>
        <span className="session-badge">ì„¸ì…˜: {sessionId.slice(-8)}</span>
      </div>
      
      <div className="messages-container">
        {messages.length === 0 && (
          <div className="empty-state">
            <div className="empty-icon">ğŸ’¬</div>
            <p>AI ìš©ì˜ìì—ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš”!</p>
            <p className="empty-hint">ì˜ˆ: "ë‹¹ì‹ ì€ ì–´ë””ì— ìˆì—ˆë‚˜ìš”?"</p>
          </div>
        )}
        
        {messages.map((message) => (
          <div 
            key={message.id} 
            className={`message ${message.role}`}
          >
            <div className="message-avatar">
              {message.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}
            </div>
            <div className="message-content">
              <div className="message-text">{message.content}</div>
              <div className="message-time">
                {new Date(message.timestamp).toLocaleTimeString('ko-KR', {
                  hour: '2-digit',
                  minute: '2-digit'
                })}
              </div>
            </div>
          </div>
        ))}
        
        {loading && (
          <div className="message assistant">
            <div className="message-avatar">ğŸ¤–</div>
            <div className="message-content">
              <div className="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        )}
        
        <div ref={messagesEndRef} />
      </div>
      
      {error && (
        <div className="error-banner">
          <span className="error-icon">âš ï¸</span>
          {error}
        </div>
      )}
      
      <div className="input-container">
        <textarea
          ref={inputRef}
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyPress={handleKeyPress}
          placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Enter: ì „ì†¡, Shift+Enter: ì¤„ë°”ê¿ˆ)"
          disabled={loading}
          rows={1}
          className="chat-input"
        />
        <button 
          onClick={sendMessage} 
          disabled={loading || !input.trim()}
          className="send-button"
        >
          {loading ? 'â³' : 'ğŸ“¤'}
        </button>
      </div>
    </div>
  );
}
```


#### 3.2 ìŠ¤íƒ€ì¼ë§
```css
/* src/client/components/ChatInterface.css */
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  max-width: 800px;
  margin: 0 auto;
  background: #f5f5f5;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.chat-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1rem 1.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.chat-header h2 {
  margin: 0;
  font-size: 1.3rem;
  font-weight: 600;
}

.session-badge {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
}

.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.empty-state {
  text-align: center;
  color: #999;
  margin-top: 3rem;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.empty-hint {
  font-size: 0.9rem;
  color: #bbb;
  margin-top: 0.5rem;
}

.message {
  display: flex;
  gap: 0.75rem;
  animation: fadeIn 0.3s ease-in;
}

.message.user {
  flex-direction: row-reverse;
}

.message-avatar {
  font-size: 2rem;
  flex-shrink: 0;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.message-content {
  max-width: 70%;
  background: white;
  padding: 0.875rem 1.125rem;
  border-radius: 1.125rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.message.user .message-content {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-bottom-right-radius: 0.25rem;
}

.message.assistant .message-content {
  border-bottom-left-radius: 0.25rem;
}

.message-text {
  word-wrap: break-word;
  white-space: pre-wrap;
  line-height: 1.5;
}

.message-time {
  font-size: 0.7rem;
  opacity: 0.6;
  margin-top: 0.375rem;
}

.typing-indicator {
  display: flex;
  gap: 0.375rem;
  padding: 0.5rem 0;
}

.typing-indicator span {
  width: 8px;
  height: 8px;
  background: #999;
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-10px);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.error-banner {
  background: #ff4444;
  color: white;
  padding: 0.875rem 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  animation: slideDown 0.3s ease-out;
}

.error-icon {
  font-size: 1.2rem;
}

@keyframes slideDown {
  from {
    transform: translateY(-100%);
  }
  to {
    transform: translateY(0);
  }
}

.input-container {
  display: flex;
  gap: 0.75rem;
  padding: 1rem 1.5rem;
  background: white;
  border-top: 1px solid #e0e0e0;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
}

.chat-input {
  flex: 1;
  padding: 0.875rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 0.75rem;
  resize: none;
  font-family: inherit;
  font-size: 1rem;
  transition: border-color 0.2s;
  max-height: 120px;
}

.chat-input:focus {
  outline: none;
  border-color: #667eea;
}

.chat-input:disabled {
  background: #f5f5f5;
  cursor: not-allowed;
}

.send-button {
  padding: 0.875rem 1.25rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 0.75rem;
  cursor: pointer;
  font-size: 1.2rem;
  transition: transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.send-button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.send-button:active:not(:disabled) {
  transform: translateY(0);
}

.send-button:disabled {
  background: #ccc;
  cursor: not-allowed;
  box-shadow: none;
}

/* ëª¨ë°”ì¼ ìµœì í™” */
@media (max-width: 768px) {
  .chat-header h2 {
    font-size: 1.1rem;
  }
  
  .message-content {
    max-width: 85%;
  }
  
  .chat-input {
    font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
  }
  
  .input-container {
    padding: 0.75rem 1rem;
  }
}

/* ë‹¤í¬ëª¨ë“œ ì§€ì› (ì„ íƒì ) */
@media (prefers-color-scheme: dark) {
  .chat-container {
    background: #1a1a1a;
  }
  
  .messages-container {
    background: #1a1a1a;
  }
  
  .message-content {
    background: #2a2a2a;
    color: #e0e0e0;
  }
  
  .message.user .message-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  
  .input-container {
    background: #2a2a2a;
    border-top-color: #3a3a3a;
  }
  
  .chat-input {
    background: #1a1a1a;
    color: #e0e0e0;
    border-color: #3a3a3a;
  }
}
```


---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. API í‚¤ ë³´í˜¸

```typescript
// âŒ ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ
const API_KEY = 'sk-1234567890abcdef'; // í•˜ë“œì½”ë”©

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
const API_KEY = process.env.API_KEY;

if (!API_KEY) {
  throw new Error('API_KEY environment variable is required');
}
```

**í™˜ê²½ë³€ìˆ˜ ì„¤ì •**:
```bash
# .env (ë¡œì»¬ ê°œë°œ)
API_KEY=your-api-key-here
EXTERNAL_API_URL=https://your-api.vercel.app/api/simple-chat

# Devvit ë°°í¬ ì‹œ
devvit secrets set API_KEY your-api-key-here
```

### 2. Rate Limiting êµ¬í˜„

```typescript
// src/server/middleware/rateLimiter.ts
interface RateLimitEntry {
  count: number;
  resetTime: number;
}

const rateLimitMap = new Map<string, RateLimitEntry>();

export function rateLimiter(
  windowMs: number = 60000,  // 1ë¶„
  maxRequests: number = 10    // 10ê°œ ìš”ì²­
) {
  return (req: Request, res: Response, next: Function) => {
    const userId = req.headers['x-user-id'] as string || 'anonymous';
    const now = Date.now();
    
    const entry = rateLimitMap.get(userId);
    
    if (!entry || now > entry.resetTime) {
      // ìƒˆ ìœˆë„ìš° ì‹œì‘
      rateLimitMap.set(userId, {
        count: 1,
        resetTime: now + windowMs
      });
      return next();
    }
    
    if (entry.count >= maxRequests) {
      const retryAfter = Math.ceil((entry.resetTime - now) / 1000);
      res.setHeader('Retry-After', retryAfter);
      return res.status(429).json({
        success: false,
        error: `ë„ˆë¬´ ë§ì€ ìš”ì²­ì…ë‹ˆë‹¤. ${retryAfter}ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`
      });
    }
    
    entry.count++;
    next();
  };
}

// ì‚¬ìš©
app.post('/api/chat', rateLimiter(60000, 10), handleChatRequest);
```

### 3. ì…ë ¥ ê²€ì¦ ë° ìƒˆë‹ˆíƒ€ì´ì œì´ì…˜

```typescript
// src/server/utils/validation.ts
export function sanitizeInput(input: string): string {
  // HTML íƒœê·¸ ì œê±°
  let sanitized = input.replace(/<[^>]*>/g, '');
  
  // íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
  sanitized = sanitized
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;');
  
  // ì—°ì† ê³µë°± ì œê±°
  sanitized = sanitized.replace(/\s+/g, ' ').trim();
  
  return sanitized;
}

export function validateMessage(message: string): {
  valid: boolean;
  error?: string;
  sanitized?: string;
} {
  if (!message || typeof message !== 'string') {
    return { valid: false, error: 'ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
  }
  
  const sanitized = sanitizeInput(message);
  
  if (sanitized.length === 0) {
    return { valid: false, error: 'ìœ íš¨í•œ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
  }
  
  if (sanitized.length > 1000) {
    return { valid: false, error: 'ë©”ì‹œì§€ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. (ìµœëŒ€ 1000ì)' };
  }
  
  // SQL Injection íŒ¨í„´ ì²´í¬
  const sqlPatterns = [
    /(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER)\b)/i,
    /(--|;|\/\*|\*\/)/
  ];
  
  for (const pattern of sqlPatterns) {
    if (pattern.test(sanitized)) {
      return { valid: false, error: 'í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' };
    }
  }
  
  return { valid: true, sanitized };
}
```

### 4. CORS ì„¤ì •

```typescript
// src/server/index.ts
import cors from 'cors';

const allowedOrigins = [
  'https://reddit.com',
  'https://www.reddit.com',
  process.env.DEVVIT_ORIGIN
].filter(Boolean);

app.use(cors({
  origin: (origin, callback) => {
    if (!origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true
}));
```

---

## ì„±ëŠ¥ ìµœì í™”

### 1. Redis ìºì‹±

```typescript
// src/server/cache/chatCache.ts
import { Devvit } from '@devvit/public-api';
import crypto from 'crypto';

export class ChatCache {
  constructor(private redis: Devvit.Context['redis']) {}
  
  private hashMessage(message: string): string {
    return crypto
      .createHash('md5')
      .update(message.toLowerCase().trim())
      .digest('hex');
  }
  
  async get(message: string): Promise<string | null> {
    const key = `chat:cache:${this.hashMessage(message)}`;
    return await this.redis.get(key);
  }
  
  async set(message: string, response: string, ttl: number = 3600): Promise<void> {
    const key = `chat:cache:${this.hashMessage(message)}`;
    await this.redis.set(key, response, {
      expiration: new Date(Date.now() + ttl * 1000)
    });
  }
  
  async clear(pattern?: string): Promise<void> {
    // íŠ¹ì • íŒ¨í„´ì˜ ìºì‹œ ì‚­ì œ
    // Redis SCAN ëª…ë ¹ ì‚¬ìš©
  }
}

// ì‚¬ìš©
export async function handleChatRequest(req: Request, res: Response) {
  const { message } = req.body;
  const cache = new ChatCache(req.context.redis);
  
  // ìºì‹œ í™•ì¸
  const cached = await cache.get(message);
  if (cached) {
    return res.json({
      success: true,
      response: cached,
      cached: true
    });
  }
  
  // API í˜¸ì¶œ
  const response = await callExternalAPI(message);
  
  // ìºì‹œ ì €ì¥
  await cache.set(message, response);
  
  return res.json({
    success: true,
    response,
    cached: false
  });
}
```

### 2. ì‘ë‹µ ì••ì¶•

```typescript
// src/server/index.ts
import compression from 'compression';

app.use(compression({
  filter: (req, res) => {
    if (req.headers['x-no-compression']) {
      return false;
    }
    return compression.filter(req, res);
  },
  level: 6 // ì••ì¶• ë ˆë²¨ (0-9)
}));
```

### 3. ì—°ê²° í’€ë§

```typescript
// src/server/utils/httpClient.ts
import { Agent } from 'https';

const httpsAgent = new Agent({
  keepAlive: true,
  maxSockets: 50,
  maxFreeSockets: 10,
  timeout: 30000
});

export async function fetchWithAgent(url: string, options: RequestInit) {
  return fetch(url, {
    ...options,
    agent: httpsAgent
  });
}
```


---

## í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```typescript
// test/chat.test.ts
import { describe, it, expect, vi } from 'vitest';
import { validateMessage, sanitizeInput } from '../src/server/utils/validation';

describe('Input Validation', () => {
  it('should validate correct message', () => {
    const result = validateMessage('ì•ˆë…•í•˜ì„¸ìš”');
    expect(result.valid).toBe(true);
    expect(result.sanitized).toBe('ì•ˆë…•í•˜ì„¸ìš”');
  });
  
  it('should reject empty message', () => {
    const result = validateMessage('');
    expect(result.valid).toBe(false);
    expect(result.error).toContain('ì…ë ¥');
  });
  
  it('should reject too long message', () => {
    const longMessage = 'a'.repeat(1001);
    const result = validateMessage(longMessage);
    expect(result.valid).toBe(false);
    expect(result.error).toContain('ë„ˆë¬´ ê¹ë‹ˆë‹¤');
  });
  
  it('should sanitize HTML tags', () => {
    const dirty = '<script>alert("xss")</script>ì•ˆë…•';
    const result = sanitizeInput(dirty);
    expect(result).not.toContain('<script>');
    expect(result).toContain('ì•ˆë…•');
  });
});

describe('Chat API', () => {
  it('should handle successful request', async () => {
    const mockFetch = vi.fn().mockResolvedValue({
      ok: true,
      json: async () => ({ response: 'ì•ˆë…•í•˜ì„¸ìš”!' })
    });
    global.fetch = mockFetch;
    
    // í…ŒìŠ¤íŠ¸ ë¡œì§
  });
  
  it('should handle timeout', async () => {
    const mockFetch = vi.fn().mockImplementation(() => 
      new Promise((_, reject) => 
        setTimeout(() => reject(new Error('AbortError')), 100)
      )
    );
    global.fetch = mockFetch;
    
    // íƒ€ì„ì•„ì›ƒ í…ŒìŠ¤íŠ¸
  });
});
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸

```typescript
// test/integration/chat-flow.test.ts
import { describe, it, expect } from 'vitest';

describe('Chat Flow Integration', () => {
  it('should complete full chat flow', async () => {
    // 1. ì‚¬ìš©ì ë©”ì‹œì§€ ì „ì†¡
    const response = await fetch('http://localhost:3000/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: 'ì•ˆë…•í•˜ì„¸ìš”',
        sessionId: 'test-session'
      })
    });
    
    expect(response.ok).toBe(true);
    
    const data = await response.json();
    expect(data.success).toBe(true);
    expect(data.response).toBeDefined();
    expect(typeof data.response).toBe('string');
  });
  
  it('should maintain session', async () => {
    const sessionId = 'test-session-2';
    
    // ì²« ë²ˆì§¸ ë©”ì‹œì§€
    const response1 = await fetch('http://localhost:3000/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: 'ë‚´ ì´ë¦„ì€ ì² ìˆ˜ì•¼',
        sessionId
      })
    });
    
    const data1 = await response1.json();
    expect(data1.success).toBe(true);
    
    // ë‘ ë²ˆì§¸ ë©”ì‹œì§€ (ì„¸ì…˜ ìœ ì§€ í™•ì¸)
    const response2 = await fetch('http://localhost:3000/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: 'ë‚´ ì´ë¦„ì´ ë­ì˜€ì§€?',
        sessionId
      })
    });
    
    const data2 = await response2.json();
    expect(data2.success).toBe(true);
    expect(data2.response.toLowerCase()).toContain('ì² ìˆ˜');
  });
});
```

### 3. ë¡œì»¬ í…ŒìŠ¤íŠ¸

```bash
# 1. ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev

# 2. ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸
# Devvit playtest URL ì—´ê¸°
# https://www.reddit.com/r/your-test-subreddit?playtest=your-app

# 3. ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
# - [ ] ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥
# - [ ] AI ì‘ë‹µ ìˆ˜ì‹ 
# - [ ] ë¡œë”© ìƒíƒœ í‘œì‹œ
# - [ ] ì—ëŸ¬ ì²˜ë¦¬ ë™ì‘
# - [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜•
# - [ ] ì„¸ì…˜ ìœ ì§€
```

### 4. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

```typescript
// test/performance/load-test.ts
import { describe, it } from 'vitest';

describe('Performance Tests', () => {
  it('should handle concurrent requests', async () => {
    const requests = Array.from({ length: 10 }, (_, i) =>
      fetch('http://localhost:3000/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: `í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ${i}`,
          sessionId: `session-${i}`
        })
      })
    );
    
    const startTime = Date.now();
    const responses = await Promise.all(requests);
    const endTime = Date.now();
    
    const allSuccessful = responses.every(r => r.ok);
    expect(allSuccessful).toBe(true);
    
    const avgTime = (endTime - startTime) / requests.length;
    console.log(`Average response time: ${avgTime}ms`);
    expect(avgTime).toBeLessThan(5000); // 5ì´ˆ ì´ë‚´
  });
});
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: íƒ€ì„ì•„ì›ƒ ì—ëŸ¬

**ì¦ìƒ**:
```
504 Gateway Timeout
ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.
```

**ì›ì¸**:
- ì™¸ë¶€ API ì‘ë‹µì´ 25ì´ˆ ì´ìƒ ì†Œìš”
- ë„¤íŠ¸ì›Œí¬ ì§€ì—°
- API ì„œë²„ ê³¼ë¶€í•˜

**í•´ê²° ë°©ë²•**:
```typescript
// 1. íƒ€ì„ì•„ì›ƒ ì‹œê°„ ì¡°ì •
const API_TIMEOUT = 20000; // 20ì´ˆë¡œ ë‹¨ì¶•

// 2. ì¬ì‹œë„ ë¡œì§ ì¶”ê°€
async function fetchWithRetry(url: string, options: RequestInit, retries = 2) {
  for (let i = 0; i < retries; i++) {
    try {
      return await fetch(url, options);
    } catch (error) {
      if (i === retries - 1) throw error;
      await sleep(1000 * (i + 1)); // ì§€ìˆ˜ ë°±ì˜¤í”„
    }
  }
}

// 3. ì‚¬ìš©ìì—ê²Œ ë” ì§§ì€ ì§ˆë¬¸ ìš”ì²­
if (message.length > 500) {
  return res.status(400).json({
    error: 'ì§ˆë¬¸ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ë” ì§§ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.'
  });
}
```

### ë¬¸ì œ 2: CORS ì—ëŸ¬

**ì¦ìƒ**:
```
Access to fetch at '...' from origin '...' has been blocked by CORS policy
```

**ì›ì¸**:
- CORS í—¤ë” ë¯¸ì„¤ì •
- ì˜ëª»ëœ origin ì„¤ì •

**í•´ê²° ë°©ë²•**:
```typescript
// src/server/index.ts
import cors from 'cors';

app.use(cors({
  origin: true, // ê°œë°œ ì¤‘ì—ëŠ” ëª¨ë“  origin í—ˆìš©
  credentials: true,
  methods: ['GET', 'POST', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// í”„ë¡œë•ì…˜ì—ì„œëŠ” íŠ¹ì • originë§Œ í—ˆìš©
const allowedOrigins = [
  'https://reddit.com',
  'https://www.reddit.com'
];

app.use(cors({
  origin: (origin, callback) => {
    if (!origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  }
}));
```

### ë¬¸ì œ 3: Rate Limit ì´ˆê³¼

**ì¦ìƒ**:
```
429 Too Many Requests
ë„ˆë¬´ ë§ì€ ìš”ì²­ì…ë‹ˆë‹¤.
```

**ì›ì¸**:
- ì‚¬ìš©ìê°€ ë„ˆë¬´ ë¹ ë¥´ê²Œ ìš”ì²­
- Rate limit ì„¤ì •ì´ ë„ˆë¬´ ì—„ê²©

**í•´ê²° ë°©ë²•**:
```typescript
// 1. Rate limit ì™„í™”
app.post('/api/chat', rateLimiter(60000, 20), handleChatRequest); // 20ê°œë¡œ ì¦ê°€

// 2. ì‚¬ìš©ìë³„ ì œí•œ
const userLimits = new Map<string, number>();

function getUserLimit(userId: string): number {
  // VIP ì‚¬ìš©ìëŠ” ë” ë§ì€ ìš”ì²­ í—ˆìš©
  if (isVIPUser(userId)) {
    return 50;
  }
  return 10;
}

// 3. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë””ë°”ìš´ì‹±
const debouncedSend = debounce(sendMessage, 1000);
```

### ë¬¸ì œ 4: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜

**ì¦ìƒ**:
- ì„œë²„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì§€ì† ì¦ê°€
- ì‘ë‹µ ì†ë„ ì ì§„ì  ì €í•˜

**ì›ì¸**:
- Rate limit map ì •ë¦¬ ì•ˆ ë¨
- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ ì•ˆ ë¨

**í•´ê²° ë°©ë²•**:
```typescript
// 1. ì£¼ê¸°ì  ì •ë¦¬
setInterval(() => {
  const now = Date.now();
  for (const [key, entry] of rateLimitMap.entries()) {
    if (now > entry.resetTime) {
      rateLimitMap.delete(key);
    }
  }
}, 60000); // 1ë¶„ë§ˆë‹¤ ì •ë¦¬

// 2. LRU ìºì‹œ ì‚¬ìš©
import LRU from 'lru-cache';

const rateLimitCache = new LRU({
  max: 10000,
  ttl: 60000
});
```


---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ ì „ ì¤€ë¹„

- [ ] ì™¸ë¶€ API ì—”ë“œí¬ì¸íŠ¸ URL í™•ë³´
- [ ] API ìš”ì²­/ì‘ë‹µ í˜•ì‹ ë¬¸ì„œí™”
- [ ] API ì¸ì¦ ë°©ì‹ í™•ì¸ (API í‚¤, OAuth ë“±)
- [ ] API ì‚¬ìš©ëŸ‰ ì œí•œ í™•ì¸
- [ ] íƒ€ì„ì•„ì›ƒ ì„¤ì • í™•ì¸
- [ ] ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ íŒŒì•…
- [ ] í…ŒìŠ¤íŠ¸ ê³„ì •/API í‚¤ ë°œê¸‰

### Phase 1: ì„œë²„ êµ¬í˜„

- [ ] íƒ€ì… ì •ì˜ ì™„ë£Œ (`src/shared/types/chat.ts`)
- [ ] í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ ìƒì„± (`/api/chat`)
- [ ] íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ êµ¬í˜„ (25ì´ˆ)
- [ ] ì…ë ¥ ê²€ì¦ í•¨ìˆ˜ ì‘ì„±
- [ ] Rate limiting êµ¬í˜„
- [ ] ì—ëŸ¬ ì²˜ë¦¬ êµ¬í˜„
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • (API í‚¤)
- [ ] ë¡œê¹… ì¶”ê°€

### Phase 2: í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„

- [ ] ChatInterface ì»´í¬ë„ŒíŠ¸ ìƒì„±
- [ ] ë©”ì‹œì§€ ìƒíƒœ ê´€ë¦¬ (useState)
- [ ] ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ êµ¬í˜„
- [ ] ë¡œë”© ìƒíƒœ í‘œì‹œ
- [ ] ì—ëŸ¬ í‘œì‹œ
- [ ] ìë™ ìŠ¤í¬ë¡¤ êµ¬í˜„
- [ ] í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Enter, Shift+Enter)
- [ ] ìŠ¤íƒ€ì¼ë§ ì™„ë£Œ
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• í™•ì¸

### Phase 3: ë³´ì•ˆ

- [ ] API í‚¤ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
- [ ] ì…ë ¥ ìƒˆë‹ˆíƒ€ì´ì œì´ì…˜
- [ ] XSS ë°©ì§€
- [ ] SQL Injection ë°©ì§€
- [ ] CORS ì„¤ì •
- [ ] Rate limiting í…ŒìŠ¤íŠ¸
- [ ] ë³´ì•ˆ í—¤ë” ì¶”ê°€

### Phase 4: ìµœì í™”

- [ ] Redis ìºì‹± êµ¬í˜„ (ì„ íƒì )
- [ ] ì‘ë‹µ ì••ì¶• í™œì„±í™”
- [ ] ì—°ê²° í’€ë§ ì„¤ì •
- [ ] ë¶ˆí•„ìš”í•œ ë¡œê·¸ ì œê±°
- [ ] ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§

### Phase 5: í…ŒìŠ¤íŠ¸

- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] Devvit playtest í…ŒìŠ¤íŠ¸
- [ ] ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸

### Phase 6: ë°°í¬

- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • í™•ì¸
- [ ] í”„ë¡œë•ì…˜ ë¹Œë“œ í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ë¡œê·¸ ìˆ˜ì§‘ ì„¤ì •
- [ ] ë°°í¬ ë¬¸ì„œ ì‘ì„±
- [ ] ë¡¤ë°± ê³„íš ìˆ˜ë¦½

---

## ì¶”ê°€ ê¸°ëŠ¥ ì•„ì´ë””ì–´

### 1. ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥

```typescript
// Redisì— ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥
interface ConversationHistory {
  sessionId: string;
  messages: Message[];
  createdAt: number;
  updatedAt: number;
}

async function saveHistory(
  sessionId: string,
  messages: Message[],
  redis: Redis
): Promise<void> {
  const key = `chat:history:${sessionId}`;
  await redis.set(key, JSON.stringify({
    sessionId,
    messages,
    createdAt: Date.now(),
    updatedAt: Date.now()
  }), {
    expiration: new Date(Date.now() + 86400000) // 24ì‹œê°„
  });
}

async function loadHistory(
  sessionId: string,
  redis: Redis
): Promise<Message[]> {
  const key = `chat:history:${sessionId}`;
  const data = await redis.get(key);
  if (!data) return [];
  
  const history: ConversationHistory = JSON.parse(data);
  return history.messages;
}
```

### 2. ë‹¤ì¤‘ AI ìºë¦­í„°

```typescript
interface AICharacter {
  id: string;
  name: string;
  personality: string;
  avatar: string;
  systemPrompt: string;
}

const characters: AICharacter[] = [
  {
    id: 'suspect1',
    name: 'ìš©ì˜ì A',
    personality: 'ì‹ ê²½ì§ˆì ì´ê³  ë°©ì–´ì ',
    avatar: 'ğŸ˜ ',
    systemPrompt: 'You are a nervous suspect...'
  },
  {
    id: 'suspect2',
    name: 'ìš©ì˜ì B',
    personality: 'ì¹¨ì°©í•˜ê³  ê³„ì‚°ì ',
    avatar: 'ğŸ˜',
    systemPrompt: 'You are a calm and calculated suspect...'
  }
];

// ìºë¦­í„° ì„ íƒ UI
function CharacterSelector({ onSelect }: { onSelect: (id: string) => void }) {
  return (
    <div className="character-selector">
      {characters.map(char => (
        <button
          key={char.id}
          onClick={() => onSelect(char.id)}
          className="character-card"
        >
          <div className="character-avatar">{char.avatar}</div>
          <div className="character-name">{char.name}</div>
          <div className="character-personality">{char.personality}</div>
        </button>
      ))}
    </div>
  );
}
```

### 3. ìŒì„± ì…ë ¥/ì¶œë ¥

```typescript
// ìŒì„± ì…ë ¥ (Web Speech API)
function useVoiceInput() {
  const [isListening, setIsListening] = useState(false);
  
  const startListening = () => {
    const recognition = new (window as any).webkitSpeechRecognition();
    recognition.lang = 'ko-KR';
    recognition.continuous = false;
    
    recognition.onstart = () => setIsListening(true);
    recognition.onend = () => setIsListening(false);
    
    recognition.onresult = (event: any) => {
      const transcript = event.results[0][0].transcript;
      setInput(transcript);
    };
    
    recognition.start();
  };
  
  return { isListening, startListening };
}

// ìŒì„± ì¶œë ¥ (Web Speech API)
function speakText(text: string) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'ko-KR';
  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  
  window.speechSynthesis.speak(utterance);
}
```

### 4. ë§ˆí¬ë‹¤ìš´ ë Œë”ë§

```typescript
import ReactMarkdown from 'react-markdown';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';

function MessageContent({ content }: { content: string }) {
  return (
    <ReactMarkdown
      components={{
        code({ node, inline, className, children, ...props }) {
          const match = /language-(\w+)/.exec(className || '');
          return !inline && match ? (
            <SyntaxHighlighter
              language={match[1]}
              PreTag="div"
              {...props}
            >
              {String(children).replace(/\n$/, '')}
            </SyntaxHighlighter>
          ) : (
            <code className={className} {...props}>
              {children}
            </code>
          );
        }
      }}
    >
      {content}
    </ReactMarkdown>
  );
}
```

### 5. íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜

```typescript
function useTypingAnimation(text: string, speed: number = 50) {
  const [displayedText, setDisplayedText] = useState('');
  const [isTyping, setIsTyping] = useState(true);
  
  useEffect(() => {
    if (displayedText.length < text.length) {
      const timeout = setTimeout(() => {
        setDisplayedText(text.slice(0, displayedText.length + 1));
      }, speed);
      return () => clearTimeout(timeout);
    } else {
      setIsTyping(false);
    }
  }, [displayedText, text, speed]);
  
  return { displayedText, isTyping };
}

// ì‚¬ìš©
function AnimatedMessage({ content }: { content: string }) {
  const { displayedText, isTyping } = useTypingAnimation(content);
  
  return (
    <div className="message-text">
      {displayedText}
      {isTyping && <span className="cursor">|</span>}
    </div>
  );
}
```

---

## ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [Devvit Documentation](https://developers.reddit.com/docs)
- [Devvit Web Apps Guide](https://developers.reddit.com/docs/web_apps)
- [Express.js Documentation](https://expressjs.com/)
- [React Documentation](https://react.dev/)

### ê´€ë ¨ íŒ¨í„´
- `.kiro/steering/patterns/successful-patterns.md` - ì„±ê³µ íŒ¨í„´
- `.kiro/steering/patterns/anti-patterns.md` - í”¼í•´ì•¼ í•  íŒ¨í„´
- `.kiro/steering/learnings/` - í”„ë¡œì íŠ¸ í•™ìŠµ ë‚´ìš©

### ë³´ì•ˆ ê°€ì´ë“œ
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP API Security](https://owasp.org/www-project-api-security/)

---

## ë²„ì „ íˆìŠ¤í† ë¦¬

### v1.0 (2025-01-15)
- ì´ˆê¸° ë¬¸ì„œ ì‘ì„±
- 3-Tier ì•„í‚¤í…ì²˜ ì„¤ê³„
- í”„ë¡ì‹œ íŒ¨í„´ êµ¬í˜„ ê°€ì´ë“œ
- ë³´ì•ˆ ê³ ë ¤ì‚¬í•­ ì¶”ê°€
- ì„±ëŠ¥ ìµœì í™” ë°©ë²•
- í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì„¹ì…˜

---

## ë¼ì´ì„ ìŠ¤

ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ ë‚´ë¶€ìš©ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì**: Kiro AI Assistant  
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-01-15  
**ë¬¸ì„œ ìƒíƒœ**: ì™„ë£Œ âœ…


병렬 Investigation Phase 구현 계획                      │
     │                                                         │
     │ 🎯 문제 확인                                            │
     │                                                         │
     │ 맞습니다! 현재 구현은 순차적(Sequential) 구조입니다.    │
     │                                                         │
     │ 현재 잘못된 플로우:                                     │
     │                                                         │
     │ Overview → Location Exploration (완료 필수) → Suspect   │
     │ Interrogation → Submission                              │
     │ - 장소 탐색을 끝내야만 용의자 심문 가능                 │
     │ - 한 번 용의자 심문으로 넘어가면 다시 장소로 돌아갈 수  │
     │ 없음                                                    │
     │ - 병렬 탐색 불가능 ❌                                    
│
     │                                                         │
     │ 올바른 플로우 (당초 기획):                              │
     │                                                         │
     │ Overview → Investigation Phase (장소↔용의자 자유롭게    │
     │ 전환) → Submission                                      │
     │ - Investigation Phase 내에서 탭으로 전환                │
     │ - 원하는 만큼 왔다갔다 가능                             │
     │ - 병렬 탐색 가능 ✅                                      
│
     │                                                         │
     │ ---                                                     │
     │ 📋 수정 계획                                            │
     │                                                         │
     │ 1. 새 컴포넌트 생성: InvestigationScreen.tsx            │
     │                                                         │
     │ 위치: src/client/components/InvestigationScreen.tsx     │
     │                                                         │
     │ 구조:                                                   │
     │ interface InvestigationScreenProps {                    │
     │   caseId: string;                                       │
     │   userId: string;                                       │
     │   caseData: CaseData;                                   │
     │   suspects: Suspect[];                                  │
     │   onGoToSubmission: () => void;                         │
     │ }                                                       │
     │                                                         │
     │ // 탭 타입                                              │
     │ type InvestigationTab = 'locations' | 'suspects';       │
     │                                                         │
     │ function InvestigationScreen({                          │
     │   caseId, userId, caseData, suspects, onGoToSubmission  │
     │ }: InvestigationScreenProps) {                          │
     │   const [activeTab, setActiveTab] =                     │
     │ useState<InvestigationTab>('locations');                │
     │                                                         │
     │   return (                                              │
     │     <div className="investigation-screen">              │
     │       {/* Header with title and submission button */}   │
     │       <Header onGoToSubmission={onGoToSubmission} />    │
     │                                                         │
     │       {/* Tab Navigation */}                            │
     │       <TabNavigation                                    │
     │         activeTab={activeTab}                           │
     │         onTabChange={setActiveTab}                      │
     │         tabs={[                                         │
     │           { id: 'locations', label: '🗺️ 장소 탐색',    │ 
     │ icon: '🔍' },                                           │
     │           { id: 'suspects', label: '👤 용의자 심문',    │
     │ icon: '💬' }                                            │
     │         ]}                                              │
     │       />                                                │
     │                                                         │
     │       {/* Content based on active tab */}               │
     │       {activeTab === 'locations' && (                   │
     │         <LocationExplorerSection                        │
     │           caseId={caseId}                               │
     │           userId={userId}                               │
     │           locations={caseData.locations || []}          │
     │         />                                              │
     │       )}                                                │
     │                                                         │
     │       {activeTab === 'suspects' && (                    │
     │         <SuspectInterrogationSection                    │
     │           caseId={caseId}                               │
     │           userId={userId}                               │
     │           suspects={suspects}                           │
     │         />                                              │
     │       )}                                                │
     │     </div>                                              │
     │   );                                                    │
     │ }                                                       │
     │                                                         │
     │ 특징:                                                   │
     │ - 2개 탭: 장소 탐색 / 용의자 심문                       │
     │ - 자유롭게 전환 가능                                    │
     │ - 같은 actionPoints 공유                                │
     │ - 같은 playerState 공유                                 │
     │                                                         │
     │ ---                                                     │
     │ 2. LocationExplorerSection 분리                         │
     │                                                         │
     │ 기존 LocationExplorerScreen에서:                        │
     │ - onNavigateToSuspects prop 제거                        │
     │ - "용의자 심문으로" 버튼 제거                           │
     │ - 순수하게 장소 탐색 기능만                             │
     │                                                         │
     │ 수정 후:                                                │
     │ // onNavigateToSuspects prop 제거                       │
     │ function LocationExplorerSection({                      │
     │   caseId,                                               │
     │   userId,                                               │
     │   locations,                                            │
     │ }: {                                                    │
     │   caseId: string;                                       │
     │   userId: string;                                       │
     │   locations: Location[];                                │
     │ }) {                                                    │
     │   // ... 기존 로직 유지                                 │
     │   // "용의자 심문으로" 버튼만 제거                      │
     │ }                                                       │
     │                                                         │
     │ ---                                                     │
     │ 3. SuspectInterrogationSection 생성                     │
     │                                                         │
     │ 기존 App.tsx의 investigation 로직을 분리:               │
     │ function SuspectInterrogationSection({                  │
     │   caseId,                                               │
     │   userId,                                               │
     │   suspects,                                             │
     │ }: {                                                    │
     │   caseId: string;                                       │
     │   userId: string;                                       │
     │   suspects: Suspect[];                                  │
     │ }) {                                                    │
     │   const { selectedSuspect, selectSuspect } =            │
     │ useSuspect(suspects);                                   │
     │   const { messages, sendMessage, loading } = useChat({  │
     │     suspectId: selectedSuspect?.id || '',               │
     │     userId,                                             │
     │     enabled: !!selectedSuspect,                         │
     │   });                                                   │
     │                                                         │
     │   return (                                              │
     │     <div>                                               │
     │       <SuspectPanel                                     │
     │         suspects={suspects}                             │
     │         selectedSuspectId={selectedSuspect?.id}         │
     │         onSelectSuspect={selectSuspect}                 │
     │       />                                                │
     │                                                         │
     │       {selectedSuspect && (                             │
     │         <ChatInterface                                  │
     │           suspectName={selectedSuspect.name}            │
     │           messages={messages}                           │
     │           onSendMessage={sendMessage}                   │
     │           loading={loading}                             │
     │         />                                              │
     │       )}                                                │
     │     </div>                                              │
     │   );                                                    │
     │ }                                                       │
     │                                                         │
     │ ---                                                     │
     │ 4. App.tsx 수정                                         │
     │                                                         │
     │ 변경 사항:                                              │
     │                                                         │
     │ A. GameScreen 타입 수정:                                │
     │ // 'location-exploration' 제거                          │
     │ type GameScreen =                                       │
     │   | 'loading'                                           │
     │   | 'intro'                                             │
     │   | 'case-overview'                                     │
     │   | 'investigation'  // 통합된 Investigation Phase      │
     │   | 'submission'                                        │
     │   | 'results';                                          │
     │                                                         │
     │ B. 핸들러 단순화:                                       │
     │ const handleStartInvestigation = useCallback(() => {    │
     │   setCurrentScreen('investigation');  // 바로           │
     │ investigation으로                                       │
     │ }, []);                                                 │
     │                                                         │
     │ // handleGoToSuspectInterrogation 제거 (더 이상 필요    │
     │ 없음)                                                   │
     │                                                         │
     │ C. 렌더링 로직 교체:                                    │
     │ // 'location-exploration' 화면 제거                     │
     │ // 'investigation' 화면을 InvestigationScreen으로 교체  │
     │                                                         │
     │ if (currentScreen === 'investigation' && caseData) {    │
     │   return (                                              │
     │     <InvestigationScreen                                │
     │       caseId={caseData.id}                              │
     │       userId={userId}                                   │
     │       caseData={caseData}                               │
     │       suspects={suspects}                               │
     │       onGoToSubmission={handleGoToSubmission}           │
     │     />                                                  │
     │   );                                                    │
     │ }                                                       │
     │                                                         │
     │ ---                                                     │
     │ 📊 수정할 파일 목록                                     │
     │                                                         │
     │ 새로 생성 (2개):                                        │
     │                                                         │
     │ 1. src/client/components/InvestigationScreen.tsx - 메인 │
     │ Investigation 화면                                      │
     │ 2. src/client/components/investigation/SuspectInterrogat│
     │ ionSection.tsx - 용의자 심문 섹션                       │
     │                                                         │
     │ 수정 (3개):                                             │
     │                                                         │
     │ 1. src/client/App.tsx - 플로우 변경                     │
     │ 2. src/client/components/LocationExplorerScreen.tsx -   │
     │ onNavigateToSuspects 제거                               │
     │ 3. src/client/types/index.ts - GameScreen 타입 업데이트 │
     │                                                         │
     │ ---                                                     │
     │ 🎮 최종 사용자 경험                                     │
     │                                                         │
     │ Before (순차적):                                        │
     │                                                         │
     │ 1. Overview → "수사 시작"                               │
     │ 2. Location Exploration (강제)                          │
     │    - 장소들 탐색                                        │
     │    - "용의자 심문으로" 버튼 클릭 (필수)                 │
     │ 3. Suspect Interrogation                                │
     │    - 용의자 심문                                        │
     │    - 다시 장소로 못 돌아감 ❌                            
│
     │ 4. Submission                                           │
     │                                                         │
     │ After (병렬):                                           │
     │                                                         │
     │ 1. Overview → "수사 시작"                               │
     │ 2. Investigation Phase                                  │
     │    [장소 탐색] [용의자 심문] ← 자유롭게 전환            │
     │                                                         │
     │    - 장소 탐색 → 증거 발견                              │
     │    - 용의자 심문 탭 클릭                                │
     │    - 용의자와 대화                                      │
     │    - 다시 장소 탐색 탭 클릭 ✅                           
│
     │    - 더 많은 증거 수집                                  │
     │    - 원하는 만큼 반복                                   │
     │                                                         │
     │ 3. "수사 완료" 버튼 → Submission                        │
     │                                                         │
     │ ---                                                     │
     │ ✅ 구현 효과                                             
│
     │                                                         │
     │ 1. 당초 기획 준수: 병렬 탐색 가능                       │
     │ 2. 사용자 경험 개선: 자유로운 조사 흐름                 │
     │ 3. 탐정 게임 본질: 증거↔심문 반복                       │
     │ 4. 코드 구조 개선: Investigation 로직 통합              │
     │                                                         │
     │ ---                                                     │
     │ 이 계획대로 수정하시겠습니까?    
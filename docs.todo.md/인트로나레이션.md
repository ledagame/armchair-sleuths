게임 인트로 나레이션 시스템 설계
1. 요구사항 분석
User Flow
사용자 게임 시작
    ↓
로딩 화면 (1-2초)
    ↓
[인트로 나레이션 시퀀스 시작]
    ↓
Phase 1: 분위기 설정 (50-80 단어)
- 장소, 시간, 감각적 디테일
- 스트리밍 방식으로 텍스트 표시
    ↓
Phase 2: 사건 발생 (50-80 단어)
- 피해자 발견, 범죄 현장
- 긴장감 고조
    ↓
Phase 3: 플레이어 역할 제시 (50-90 단어)
- 탐정으로서의 임무
- 시간 압박, 용의자 정보
- 행동 촉구
    ↓
[인트로 종료]
    ↓
기존 케이스 개요 화면으로 전환
Data Flow
게임 시작
    ↓
GET /api/case/today (케이스 데이터 로드)
    ↓
케이스 데이터 수신
    ↓
인트로 나레이션 생성
- 케이스 정보 기반 (피해자, 장소, 무기)
- 템플릿 + 동적 데이터 결합
    ↓
나레이션 스트리밍 표시
- 청크 단위로 텍스트 표시
- 타이핑 효과
    ↓
사용자 인터랙션
- Skip 버튼 (전체 텍스트 즉시 표시)
- 자동 진행 (완료 후 케이스 개요로)
    ↓
케이스 개요 화면
2. 코드베이스 분석
관련 파일 탐색
Searched workspace
클라이언트 메인 앱 파일 찾기
Searched workspace
클라이언트 디렉토리 구조 확인
Read file(s)

App.tsx

main.tsx
Searched workspace
컴포넌트 구조 확인
Read file(s)

index.ts
3. 모듈 설계
개요
| 모듈 | 위치 | 설명 | |------|------|------| | IntroNarration | src/client/components/intro/IntroNarration.tsx | 인트로 나레이션 UI 컴포넌트 (Presentation) | | NarrationService | src/server/services/narration/NarrationService.ts | 나레이션 생성 비즈니스 로직 (Business Logic) | | useIntroNarration | src/client/hooks/useIntroNarration.ts | 인트로 상태 관리 훅 (Presentation Logic) | | Types | src/client/types/index.ts | 나레이션 관련 타입 정의 (Shared) |

Diagram
graph TB
    subgraph "Client (Presentation)"
        App[App.tsx]
        IntroScreen[IntroNarration.tsx]
        Hook[useIntroNarration.ts]
    end
    
    subgraph "Server (Business Logic)"
        NarrationService[NarrationService.ts]
        CaseRepo[CaseRepository.ts]
    end
    
    subgraph "Data"
        Redis[(Redis KV)]
    end
    
    App -->|"currentScreen === 'intro'"| IntroScreen
    IntroScreen -->|"상태 관리"| Hook
    Hook -->|"케이스 데이터"| App
    
    IntroScreen -->|"나레이션 텍스트"| NarrationService
    NarrationService -->|"케이스 데이터 조회"| CaseRepo
    CaseRepo -->|"case:{caseId}"| Redis
    
    IntroScreen -.->|"완료 후"| App
    App -.->|"전환"| CaseOverview[CaseOverview.tsx]
    
    style IntroScreen fill:#4a9eff
    style NarrationService fill:#ff9a4a
    style Hook fill:#4a9eff
4. Implementation Plan
Module 1: Types (Shared)
파일: src/client/types/index.ts (기존 파일 수정)

추가할 타입:

// 나레이션 페이즈
export type NarrationPhase = 'atmosphere' | 'incident' | 'stakes';

// 나레이션 블록
export interface NarrationBlock {
  phase: NarrationPhase;
  text: string;
  wordCount: number;
}

// 인트로 나레이션 데이터
export interface IntroNarration {
  caseId: string;
  atmosphere: string;    // 50-80 단어
  incident: string;      // 50-80 단어
  stakes: string;        // 50-90 단어
  totalWordCount: number;
}

// 게임 화면에 'intro' 추가
export type GameScreen =
  | 'loading'
  | 'intro'              // 새로 추가
  | 'case-overview'
  | 'investigation'
  | 'submission'
  | 'results';
검증: TypeScript 컴파일 확인

Module 2: NarrationService (Business Logic)
파일: src/server/services/narration/NarrationService.ts (신규)

역할:

케이스 데이터 기반 인트로 나레이션 생성
템플릿 기반 접근 (AI 없이 빠른 구현)
3단계 나레이션 블록 생성
주요 메서드:

class NarrationService {
  // 인트로 나레이션 생성
  generateIntroNarration(caseData: CaseData): IntroNarration
  
  // Phase 1: 분위기 설정
  private generateAtmosphere(caseData: CaseData): string
  
  // Phase 2: 사건 발생
  private generateIncident(caseData: CaseData): string
  
  // Phase 3: 플레이어 역할
  private generateStakes(caseData: CaseData): string
}
템플릿 구조:

장소별 분위기 템플릿 (저택, 도시, 시골 등)
무기별 사건 묘사 템플릿
시간대별 긴장감 표현
Unit Test:

describe('NarrationService', () => {
  test('인트로 나레이션 생성 - 모든 페이즈 포함', () => {
    // Given: 케이스 데이터
    // When: generateIntroNarration 호출
    // Then: atmosphere, incident, stakes 모두 생성됨
  });
  
  test('단어 수 제한 준수 - 각 페이즈', () => {
    // Given: 케이스 데이터
    // When: 각 페이즈 생성
    // Then: atmosphere 50-80단어, incident 50-80단어, stakes 50-90단어
  });
  
  test('감각적 디테일 포함 - 분위기 페이즈', () => {
    // Given: 케이스 데이터
    // When: generateAtmosphere 호출
    // Then: 시각, 청각, 후각 등 감각 표현 포함
  });
});
Module 3: useIntroNarration Hook (Presentation Logic)
파일: src/client/hooks/useIntroNarration.ts (신규)

역할:

인트로 나레이션 상태 관리
스트리밍 효과 제어
Skip 기능 처리
주요 기능:

interface UseIntroNarrationReturn {
  // 현재 표시 중인 텍스트
  displayedText: string;
  
  // 현재 페이즈
  currentPhase: NarrationPhase | null;
  
  // 스트리밍 완료 여부
  isComplete: boolean;
  
  // Skip 함수
  skip: () => void;
  
  // 다음 페이즈로 진행
  nextPhase: () => void;
}

function useIntroNarration(narration: IntroNarration): UseIntroNarrationReturn
스트리밍 로직:

단어 단위로 점진적 표시
200ms 간격 (자연스러운 읽기 속도)
Skip 시 즉시 전체 텍스트 표시
페이즈 완료 후 자동 다음 페이즈
QA Sheet:

기능_테스트:
  - [ ] 텍스트가 단어 단위로 스트리밍되는가?
  - [ ] Skip 버튼 클릭 시 즉시 전체 텍스트 표시되는가?
  - [ ] 3개 페이즈가 순차적으로 진행되는가?
  - [ ] 마지막 페이즈 완료 후 자동으로 다음 화면 전환되는가?

성능_테스트:
  - [ ] 스트리밍 딜레이가 자연스러운가? (200ms)
  - [ ] 메모리 누수 없는가? (cleanup 함수)
  - [ ] 재렌더링 최적화되었는가?

UX_테스트:
  - [ ] 읽기 속도가 적절한가?
  - [ ] Skip 버튼이 명확하게 보이는가?
  - [ ] 페이즈 전환이 부드러운가?
  - [ ] 전체 인트로 시간이 적절한가? (45-75초)
Module 4: IntroNarration Component (Presentation)
파일: src/client/components/intro/IntroNarration.tsx (신규)

역할:

인트로 나레이션 UI 렌더링
타이핑 효과 애니메이션
Skip 버튼 및 진행 표시
Props:

interface IntroNarrationProps {
  caseData: CaseData;
  onComplete: () => void;  // 인트로 완료 시 콜백
}
UI 구조:

┌─────────────────────────────────────┐
│                                     │
│         [어두운 배경 이미지]         │
│                                     │
│     ┌─────────────────────┐        │
│     │                     │        │
│     │  [나레이션 텍스트]   │        │
│     │  타이핑 효과로 표시  │        │
│     │                     │        │
│     └─────────────────────┘        │
│                                     │
│  [Phase 1/3]        [Skip ⏭️]      │
│                                     │
└─────────────────────────────────────┘
스타일링:

어두운 배경 (검은색 또는 어두운 그라데이션)
중앙 정렬 텍스트 박스
이탤릭체 나레이션 텍스트
페이드인 애니메이션
Skip 버튼 (우측 하단)
QA Sheet:

시각적_검증:
  - [ ] 배경이 충분히 어두운가?
  - [ ] 텍스트 가독성이 좋은가?
  - [ ] 타이핑 효과가 자연스러운가?
  - [ ] 페이즈 인디케이터가 명확한가?

인터랙션_검증:
  - [ ] Skip 버튼이 항상 접근 가능한가?
  - [ ] 클릭 시 즉시 반응하는가?
  - [ ] 키보드 단축키 지원하는가? (Space/Enter)
  - [ ] 모바일에서 터치 동작하는가?

애니메이션_검증:
  - [ ] 페이드인이 부드러운가?
  - [ ] 페이즈 전환이 자연스러운가?
  - [ ] 완료 후 페이드아웃이 있는가?

접근성_검증:
  - [ ] 스크린 리더 지원하는가?
  - [ ] 키보드 네비게이션 가능한가?
  - [ ] 색상 대비가 충분한가?
Module 5: App.tsx Integration (Presentation)
파일: src/client/App.tsx (기존 파일 수정)

변경 사항:

GameScreen 타입에 'intro' 추가 (이미 타입에 반영)
로딩 완료 후 'intro' 화면으로 전환
인트로 완료 후 'case-overview'로 전환
IntroNarration 컴포넌트 렌더링 추가
수정 위치:

// useEffect 수정
useEffect(() => {
  if (caseLoading) {
    setCurrentScreen('loading');
  } else if (caseError) {
    setCurrentScreen('loading');
  } else if (caseData && currentScreen === 'loading') {
    setCurrentScreen('intro');  // 'case-overview' → 'intro'로 변경
  }
}, [caseLoading, caseError, caseData, currentScreen]);

// renderScreen에 intro 케이스 추가
if (currentScreen === 'intro' && caseData) {
  return <IntroNarration caseData={caseData} onComplete={handleIntroComplete} />;
}
QA Sheet:

화면_전환_검증:
  - [ ] 로딩 → 인트로 전환이 자연스러운가?
  - [ ] 인트로 → 케이스 개요 전환이 자연스러운가?
  - [ ] 뒤로가기 시 인트로 다시 재생 안 되는가?

상태_관리_검증:
  - [ ] currentScreen 상태가 올바르게 업데이트되는가?
  - [ ] 케이스 데이터가 인트로에 전달되는가?
  - [ ] 인트로 완료 콜백이 정상 작동하는가?
Module 6: Server API Endpoint (Optional)
파일: src/server/index.ts (기존 파일 수정)

엔드포인트: GET /api/narration/:caseId (선택 사항)

역할:

케이스 ID 기반 인트로 나레이션 반환
캐싱 지원 (동일 케이스 재요청 시)
현재는 클라이언트에서 직접 생성하는 방식으로 구현 가능

서버 호출 없이 빠른 표시
나중에 AI 기반 생성으로 확장 시 서버 엔드포인트 추가
5. 구현 순서
Phase 1: 기본 구조 (1-2시간)
타입 정의 추가

src/client/types/index.ts에 나레이션 타입 추가
GameScreen에 'intro' 추가
NarrationService 생성

템플릿 기반 나레이션 생성 로직
3개 페이즈 생성 메서드
Unit test 작성
Phase 2: UI 컴포넌트 (2-3시간)
useIntroNarration 훅 생성

스트리밍 로직 구현
Skip 기능 구현
페이즈 전환 로직
IntroNarration 컴포넌트 생성

UI 레이아웃
타이핑 효과 애니메이션
Skip 버튼
페이즈 인디케이터
Phase 3: 통합 (1시간)
App.tsx 통합

화면 전환 로직 수정
IntroNarration 렌더링 추가
완료 콜백 처리
테스트 및 조정

전체 플로우 테스트
타이밍 조정
UX 개선
6. 세부 구현 계획
NarrationService 구현 계획
템플릿 구조:

분위기_템플릿:
  저택:
    - "고풍스러운 저택이 폭풍우 속에 우뚝 서 있다"
    - "번개가 높은 창문을 비추며..."
    - "샹들리에가 떨리는 그림자를 드리운다"
  
  도시:
    - "네온사인이 빗물에 반사되어 번진다"
    - "새벽 2시 47분. 도시는 비틀거린다"
    - "24시간 영업 간판이 붉고 금빛으로 빛난다"
  
  시골:
    - "안개가 들판을 뒤덮고 있다"
    - "외딴 농가가 어둠 속에 잠겨있다"
    - "까마귀 울음소리만이 정적을 깬다"

사건_템플릿:
  발견:
    - "{피해자명}, {나이}세, {장소}에서 사망한 채 발견"
    - "침입 흔적 없음. 몸싸움 소리 들리지 않음"
    - "단지 침묵, 그리고 청소 담당자의 비명"
  
  상태:
    - "시신은 {위치}에 쓰러져 있다"
    - "{무기}가 {위치}에 있다"
    - "현장은 {상태} 상태다"

역할_템플릿:
  탐정:
    - "당신은 {역할}, {부서}소속이다"
    - "이번 달 세 번째 의심스러운 죽음"
    - "{용의자 수}명이 건물 안에 있었다"
    - "보안 영상에는 아무도 나가지 않았다"
    - "누군가는 뭔가를 알고 있다"
동적 데이터 삽입:

{피해자명} → caseData.victim.name
{장소} → caseData.location.name
{무기} → caseData.weapon.name
{용의자 수} → caseData.suspects.length
Unit Test 시나리오:

기본 케이스 데이터로 나레이션 생성
각 페이즈 단어 수 검증
동적 데이터 올바르게 삽입되는지 확인
다양한 케이스 타입 (저택/도시/시골) 테스트
useIntroNarration Hook 구현 계획
상태 관리:

const [currentPhase, setCurrentPhase] = useState<NarrationPhase>('atmosphere');
const [displayedText, setDisplayedText] = useState<string>('');
const [isComplete, setIsComplete] = useState<boolean>(false);
const [isSkipped, setIsSkipped] = useState<boolean>(false);
스트리밍 로직:

useEffect로 단어 단위 스트리밍
setInterval 사용 (200ms 간격)
cleanup 함수로 메모리 누수 방지
페이즈 전환:

atmosphere 완료 → 1초 대기 → incident
incident 완료 → 1초 대기 → stakes
stakes 완료 → isComplete = true
Skip 처리:

현재 페이즈 전체 텍스트 즉시 표시
다음 페이즈로 자동 진행
또는 전체 인트로 스킵 옵션
IntroNarration Component 구현 계획
레이아웃:

전체 화면 (fullscreen)
- 배경: 어두운 그라데이션 또는 케이스 이미지 (흐림 처리)
- 중앙: 나레이션 텍스트 박스
- 하단: 페이즈 인디케이터 + Skip 버튼
애니메이션:

컴포넌트 마운트 시 페이드인
텍스트 타이핑 효과 (CSS 또는 JS)
페이즈 전환 시 부드러운 전환
완료 시 페이드아웃
인터랙션:

Skip 버튼 클릭
Space/Enter 키로 Skip
자동 진행 (각 페이즈 완료 후)
QA Sheet:

UI_검증:
  - [ ] 텍스트가 중앙에 정렬되는가?
  - [ ] 배경이 텍스트를 방해하지 않는가?
  - [ ] 폰트 크기가 적절한가? (모바일/데스크톱)
  - [ ] 색상 대비가 충분한가?

애니메이션_검증:
  - [ ] 페이드인이 부드러운가?
  - [ ] 타이핑 효과가 자연스러운가?
  - [ ] 페이즈 전환이 매끄러운가?
  - [ ] 완료 후 페이드아웃이 있는가?

반응형_검증:
  - [ ] 모바일에서 텍스트가 잘 보이는가?
  - [ ] 태블릿에서 레이아웃이 적절한가?
  - [ ] 데스크톱에서 너무 크지 않은가?

접근성_검증:
  - [ ] 키보드로 Skip 가능한가?
  - [ ] 스크린 리더가 텍스트를 읽는가?
  - [ ] 색맹 사용자도 구별 가능한가?
App.tsx 통합 계획
수정 위치 1: useEffect

// 로딩 완료 후 intro로 전환
useEffect(() => {
  if (caseLoading) {
    setCurrentScreen('loading');
  } else if (caseError) {
    setCurrentScreen('loading');
  } else if (caseData && currentScreen === 'loading') {
    setCurrentScreen('intro');  // 변경
  }
}, [caseLoading, caseError, caseData, currentScreen]);
수정 위치 2: 콜백 추가

const handleIntroComplete = useCallback(() => {
  setCurrentScreen('case-overview');
}, []);
수정 위치 3: renderScreen

// intro 화면 렌더링 추가
if (currentScreen === 'intro' && caseData) {
  return (
    <IntroNarration 
      caseData={caseData} 
      onComplete={handleIntroComplete} 
    />
  );
}
7. 예상 결과
사용자 경험
1. 게임 시작
   ↓
2. 로딩 (1-2초)
   ↓
3. 인트로 나레이션 시작 (자동)
   - Phase 1: 분위기 (15-20초)
     "고풍스러운 저택이 폭풍우 속에..."
   - Phase 2: 사건 (15-20초)
     "김지수, 28세, 사망한 채 발견..."
   - Phase 3: 역할 (15-20초)
     "당신은 형사 이민호..."
   ↓
4. 인트로 완료 (45-60초 총 소요)
   ↓
5. 케이스 개요 화면
Skip 옵션
사용자가 Skip 버튼 클릭
    ↓
현재 페이즈 전체 텍스트 즉시 표시
    ↓
1초 후 다음 페이즈 또는 완료
    ↓
총 소요 시간: 5-10초
8. 확장 가능성
Phase 2 (향후 개선)
AI 기반 나레이션:

Gemini API로 동적 나레이션 생성
케이스별 맞춤 스토리텔링
더 풍부한 감각적 표현
음향 효과:

배경 음악 (긴장감 있는 BGM)
효과음 (천둥, 빗소리 등)
음성 나레이션 (TTS)
시각 효과:

케이스 이미지 배경
파티클 효과 (비, 안개)
시네마틱 전환
사용자 설정:

나레이션 속도 조절
자동 Skip 옵션
인트로 비활성화 (재플레이 시)
9. 기술적 고려사항
성능
스트리밍 최적화: requestAnimationFrame 사용 고려
메모리 관리: useEffect cleanup 필수
번들 크기: 템플릿 데이터 최소화
호환성
모바일 우선: Reddit 사용자 대부분 모바일
브라우저 지원: 최신 Chrome, Safari, Firefox
Devvit 제약: 30초 타임아웃 내 완료
접근성
WCAG 2.1 AA 준수
키보드 네비게이션
스크린 리더 지원
색상 대비 4.5:1 이상